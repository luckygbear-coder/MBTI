// =========================
// MBTIç†Š - app.jsï¼ˆå®Œæ•´ 16 å‹ + Modal å½ˆçª—ç‰ˆï¼‰
// =========================

const DEFAULT_TEST_URL = "https://www.16personalities.com/";

// ç†Šç†Šé»æ“Šéš¨æ©Ÿèªå¥/å•é¡Œ
const BEAR_QUOTES = [
  "ğŸ» ä½ ç¾åœ¨æœ€æƒ³è¢«ç†è§£çš„æ˜¯å“ªä¸€ä»¶äº‹ï¼Ÿ",
  "ğŸ» ä½ ä»Šå¤©åšå¾—æœ€æ£’çš„ä¸€ä»¶å°äº‹æ˜¯ä»€éº¼ï¼Ÿ",
  "ğŸ» å¦‚æœæŠŠä½ ç•¶æˆå†’éšªè€…ï¼Œä½ çš„ã€è£œçµ¦å“ã€æ˜¯ä»€éº¼ï¼Ÿï¼ˆç¡çœ /æœ‹å‹/é‹å‹•/å‰µä½œâ€¦ï¼‰",
  "ğŸ» ä½ æœ€è¿‘æœ€å¸¸å¡ä½çš„æƒ…ç·’æ˜¯ï¼šç„¦æ…®ã€å§”å±ˆã€ç”Ÿæ°£ã€ç©ºè™›ã€ç–²æ†Šï¼Œå“ªä¸€å€‹ï¼Ÿ",
  "ğŸ» ä½ å¸Œæœ›é—œä¿‚è£¡æ›´å¸¸å‡ºç¾ï¼šè¢«è‚¯å®šã€è¢«ç†è§£ã€è¢«å°Šé‡ã€è¢«é™ªä¼´ï¼Ÿ",
  "ğŸ» ä¸æ˜¯è¦è®Šæˆåˆ¥äººï¼Œæ˜¯æŠŠè‡ªå·±ç”¨å¾—æ›´é †ã€æ›´èˆ’æœã€‚",
  "ğŸ» ä»Šå¤©å…ˆç…§é¡§è‡ªå·± 1% å°±å¾ˆæ£’äº†ã€‚",
  "ğŸ» ä½ æƒ³è¦çš„ç­”æ¡ˆï¼Œå¯èƒ½è—åœ¨ä½ ä¸æ•¢èªªå‡ºå£çš„é‚£å¥è©±è£¡ã€‚"
];

// =========================
// âœ… å®Œæ•´ 16 å‹è³‡æ–™
// =========================
const MBTI = {
  ISTJ: {
    name: "ç‰©æµå®ˆè­·ç†Š",
    tags: ["å‹™å¯¦", "å®ˆè¦", "å¯é "],
    traits: "é‡è¦–ç§©åºèˆ‡è²¬ä»»ï¼Œåå¥½æ¸…æ¥šè¦å‰‡èˆ‡å¯é æœŸæµç¨‹ã€‚",
    strengths: ["ç©©å®šå¯é ", "æŠŠäº‹åšå®Œ", "é¢¨éšªæ§ç®¡"],
    blindspots: ["å°è®Šå‹•è¼ƒç„¦æ…®", "å®¹æ˜“å°æ¨™æº–éåš´", "æƒ…ç·’è¡¨é”è¼ƒå«è“„"],
    work: ["è¡Œæ”¿/æ³•å‹™/ç¨½æ ¸", "å°ˆæ¡ˆç®¡æ§/PMO", "å“è³ªç®¡ç†/æµç¨‹æ”¹å–„"],
    workTips: [
      "å…ˆæŠŠç›®æ¨™æ‹†æˆã€å¯æª¢æ ¸é‡Œç¨‹ç¢‘ã€ï¼Œä½ çš„æ•ˆç‡æœƒæ›´ææ€–ã€‚",
      "é‡åˆ°è®Šæ›´åˆ¥æ€¥è‘—å¦å®šï¼šå…ˆå•ã€é¢¨éšªæ˜¯ä»€éº¼ï¼Ÿæˆ‘éœ€è¦å“ªäº›è³‡è¨Šï¼Ÿã€",
      "çµ¦è‡ªå·±ç•™ 10% å½ˆæ€§ï¼Œä¸å¿…æ¯ä»¶äº‹éƒ½åšåˆ° 100 åˆ†æ‰ç®—å¥½ã€‚"
    ],
    loveTips: [
      "ä½ å¸¸ç”¨ã€ç…§é¡§/è² è²¬ã€è¡¨é”æ„›ï¼Œä¹Ÿå¯ä»¥ç·´ç¿’èªªå‡ºæ„Ÿå—ã€‚",
      "åˆ¥æŠŠå°æ–¹çš„é¬†æ•£è¦–ç‚ºä¸åœ¨ä¹ï¼Œå…ˆè«‡ã€æœŸå¾…èˆ‡ç•Œç·šã€ã€‚",
      "å›ºå®šç›¸è™•å„€å¼ï¼ˆæ¯é€±ç´„æœƒ/æ¯æ—¥ 10 åˆ†é˜èŠå¤©ï¼‰å¾ˆé©åˆä½ ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ æ˜¯å¯é çš„é å±±ï¼Œä½†ä½ ä¹Ÿå€¼å¾—è¢«ç…§é¡§ã€‚"
  },

  ISFJ: {
    name: "æš–å¿ƒç…§è­·ç†Š",
    tags: ["é«”è²¼", "ç´°è†©", "å®ˆè­·"],
    traits: "é‡è¦–é—œä¿‚èˆ‡æ‰¿è«¾ï¼Œæ“…é•·ç…§é¡§ä»–äººã€è¨˜å¾—ç´°ç¯€ã€‚",
    strengths: ["é«˜åŒç†", "é»˜é»˜ä»˜å‡º", "ç©©å®šæ”¯æŒ"],
    blindspots: ["ä¸æ•¢æ‹’çµ•", "å§”å±ˆç´¯ç©", "éåº¦åœ¨æ„è©•åƒ¹"],
    work: ["äººè³‡/å®¢æœ/ç…§è­·", "æ•™å­¸/è¡Œæ”¿æ”¯æ´", "ç‡Ÿé‹/å®¢æˆ¶æˆåŠŸ"],
    workTips: [
      "å…ˆå­¸æœƒèªªã€æˆ‘éœ€è¦æƒ³ä¸€ä¸‹ã€ï¼Œé€™æ˜¯æº«æŸ”çš„ç•Œç·šã€‚",
      "æŠŠä»˜å‡ºå¯è¦–åŒ–ï¼šç”¨æ¸…å–®/å›å ±è®“åƒ¹å€¼è¢«çœ‹è¦‹ã€‚",
      "é‡åˆ°è¡çªå…ˆå¯«ä¸‹éœ€æ±‚ï¼šæˆ‘æƒ³è¦ä»€éº¼ï¼Ÿæˆ‘å®³æ€•ä»€éº¼ï¼Ÿ"
    ],
    loveTips: [
      "åˆ¥åªåšä¸èªªï¼šç·´ç¿’æå‡ºéœ€æ±‚ã€æˆ‘å¸Œæœ›ä½ â€¦ã€",
      "å…è¨±å°æ–¹ç…§é¡§ä½ ï¼Œä¸è¦æŠŠæ‰€æœ‰ç…§é¡§éƒ½æ”¬åœ¨è‡ªå·±èº«ä¸Šã€‚",
      "ç•¶ä½ æƒ³å¿è€æ™‚å…ˆå•ï¼šé€™æ˜¯æ„›ï¼Ÿé‚„æ˜¯å®³æ€•å¤±å»ï¼Ÿ"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šæº«æŸ”ä¸æ˜¯å¿è€ï¼Œæº«æŸ”ä¹Ÿå¯ä»¥å¾ˆæœ‰ç•Œç·šã€‚"
  },

  INFJ: {
    name: "é è¨€å¼•è·¯ç†Š",
    tags: ["æ´å¯Ÿ", "ç†æƒ³", "æ·±åº¦"],
    traits: "æ´å¯Ÿäººå¿ƒèˆ‡è¶¨å‹¢ï¼Œé‡è¦–æ„ç¾©èˆ‡é•·æœŸæ–¹å‘ã€‚",
    strengths: ["çœ‹è¦‹æœ¬è³ª", "æ•´åˆé¡˜æ™¯", "åŒç†å¼•å°"],
    blindspots: ["æƒ³å¤ªå¤šè€—èƒ½", "åƒ¹å€¼è§€æ•æ„Ÿ", "æ‚¶è‘—ä¸èªª"],
    work: ["å“ç‰Œ/å…§å®¹ç­–ç•¥", "é¡§å•/æ•™ç·´/åŠ©äºº", "ç ”ç©¶/è¨­è¨ˆæ€è€ƒ"],
    workTips: [
      "æŠŠç›´è¦ºè½åœ°ï¼šç”¨ã€ä¸‹ä¸€æ­¥å¯è¡Œå‹•ã€æ”¶æ–‚ç„¦æ…®ã€‚",
      "åˆ¥æŠŠè²¬ä»»å…¨æ‰›ï¼šæ¸…æ¥šåˆ†å·¥èƒ½ä¿è­·èƒ½é‡ã€‚",
      "æƒ³æ¶ˆå¤±æ™‚å…ˆè£œèƒ½ï¼ˆç¡çœ /æ•£æ­¥/å®‰éœï¼‰å†æ±ºå®šã€‚"
    ],
    loveTips: [
      "ä½ æ¸´æœ›æ·±å±¤ç†è§£ï¼šå…ˆè¬›æ¸…æ¥šä½ åœ¨ä¹çš„åƒ¹å€¼ã€‚",
      "åˆ¥ç”¨æš—ç¤ºæ¸¬è©¦å°æ–¹ï¼Œç›´æ¥èªªï¼šæˆ‘å¸Œæœ›ä½ æ€éº¼åšã€‚",
      "æŠŠæœŸå¾…åˆ†ç´šï¼šå¿…è¦/åŠ åˆ†/å¯æœ‰å¯ç„¡ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæ·±ï¼Œä½†ä¸ç”¨æ¯æ¬¡éƒ½æ½›æ°´åˆ°åº•ï¼Œæµ®ä¸Šä¾†ä¹Ÿå®‰å…¨ã€‚"
  },

  INTJ: {
    name: "ç­–ç•¥è»å¸«ç†Š",
    tags: ["ç­–ç•¥", "ç¨ç«‹", "é«˜æ¨™"],
    traits: "æ“…é•·ç³»çµ±åŒ–èˆ‡é•·æœŸè¦åŠƒï¼Œå–œæ­¡æœ‰æ•ˆç‡çš„è§£æ³•ã€‚",
    strengths: ["è¦åŠƒåŠ›å¼·", "åˆ¤æ–·ç²¾æº–", "è‡ªæˆ‘é©…å‹•"],
    blindspots: ["å°ä½æ•ˆç‡æ•æ„Ÿ", "è¡¨é”è¼ƒå†·", "ä¸æ„›æ±‚åŠ©"],
    work: ["ç”¢å“/ç­–ç•¥/æ•¸æ“š", "ç ”ç™¼/å·¥ç¨‹/æ¶æ§‹", "æŠ•ç ”/å•†æ¥­åˆ†æ"],
    workTips: [
      "ç”¨ã€å½±éŸ¿åŠ›ã€è€Œä¸æ˜¯ã€æ­£ç¢ºæ€§ã€ä¾†æºé€šï¼Œæ›´å¿«è¢«æ¡ç´ã€‚",
      "å»ºç«‹å›é¥‹è¿´è·¯ï¼šå®šæœŸè½ä½¿ç”¨è€…/åŒäº‹çš„çœŸå¯¦ç—›é»ã€‚",
      "å…ˆåšåˆ° 70% å†è¿­ä»£ï¼Œæ¯”ç­‰å®Œç¾æ›´å¿«ã€‚"
    ],
    loveTips: [
      "ä½ é‡è¦–å°Šé‡èˆ‡ç©ºé–“ï¼Œä¹Ÿåˆ¥å¿˜äº†ã€æƒ…ç·’ä¸Šçš„å›æ‡‰ã€ã€‚",
      "æŠŠã€æˆ‘åœ¨æƒ³ã€è®Šæˆã€æˆ‘åœ¨ä¹ã€ï¼šä¸€å¥ç¢ºèªå¾ˆåŠ åˆ†ã€‚",
      "è¡çªå…ˆèªªç›®çš„ï¼šæˆ‘æƒ³æŠŠæˆ‘å€‘è®Šæ›´å¥½ï¼Œä¸æ˜¯è¦è´ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„è…¦å¾ˆå¼·ï¼Œä½†ä½ çš„å¿ƒä¹Ÿå¾ˆé‡è¦ã€‚"
  },

  ISTP: {
    name: "æ©Ÿå·§æ¢ç´¢ç†Š",
    tags: ["å†·éœ", "å‹•æ‰‹", "è‡¨å ´"],
    traits: "å–œæ­¡å¯¦ä½œèˆ‡è§£æ±ºå•é¡Œï¼Œè‡¨å ´åæ‡‰å¿«ã€‚",
    strengths: ["æ’é™¤æ•…éšœ", "å¯¦å‹™å°å‘", "æŠ—å£“"],
    blindspots: ["ä¸æ„›å†—é•·æºé€š", "æ‰¿è«¾å£“åŠ›å¤§", "æƒ…ç·’æ™šåˆ°"],
    work: ["å·¥ç¨‹/ç¶­é‹/è³‡å®‰", "æŠ€è¡“æ”¯æ´/ä¿®å¾©", "å·¥æ¥­è¨­è¨ˆ/å·¥å…·é¡"],
    workTips: [
      "ç”¨ Demo èªªè©±ï¼šä½ æœ€æœ‰èªªæœåŠ›çš„èªè¨€æ˜¯æˆæœã€‚",
      "é‡è¦è³‡è¨Šå¯«ä¸‹ä¾†ï¼ˆçœ‹æ¿/å‚™å¿˜ï¼‰ï¼Œé¿å…å£é ­è’¸ç™¼ã€‚",
      "é‡åˆ°æ‘©æ“¦ï¼šå…ˆè¬›äº‹å¯¦+éœ€æ±‚ï¼Œå°‘ç”¨çµè«–å¼èªæ°£ã€‚"
    ],
    loveTips: [
      "ä½ è¡¨é”æ„›åè¡Œå‹•æ´¾ï¼Œå¶çˆ¾åŠ ä¸€å¥è‚¯å®šæœƒæ›´ç”œã€‚",
      "åˆ¥é»˜é»˜æ¶ˆå¤±ï¼šç°¡çŸ­èªªæ˜ã€æˆ‘éœ€è¦ä¸€é»æ™‚é–“å†·éœã€ã€‚",
      "ä¸€èµ·åšäº‹ï¼ˆé‹å‹•/æ—…è¡Œ/æ‰‹ä½œï¼‰æ¯”ä¸€ç›´è«‡å¿ƒæ›´é©åˆä½ ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒæŠŠå•é¡Œè®Šç°¡å–®ï¼Œä¹Ÿåˆ¥å¿˜äº†æŠŠæ„Ÿå—èªªç°¡å–®ã€‚"
  },

  ISFP: {
    name: "æ„Ÿå—è—è¡“ç†Š",
    tags: ["æº«æŸ”", "å¯©ç¾", "è‡ªç”±"],
    traits: "é‡è¦–æ„Ÿå—èˆ‡çœŸèª ï¼Œå–œæ­¡åšè‡ªå·±ã€æœ‰ç¾æ„Ÿã€‚",
    strengths: ["åŒç†æº«æš–", "å¯©ç¾è¡¨é”", "æ´»åœ¨ç•¶ä¸‹"],
    blindspots: ["è¨å­è¡çª", "æ±ºç­–æ˜“çŒ¶è±«", "å£“åŠ›å¤§æœƒé€ƒèµ°"],
    work: ["è¨­è¨ˆ/å½±åƒ/æ’ç•«", "æœå‹™é«”é©—/é¤æ—…", "ç…§è­·/æ•™è‚²æ´»å‹•"],
    workTips: [
      "æŠŠéˆæ„Ÿè®Šæµç¨‹ï¼šå»ºç«‹å¯é‡è¤‡çš„å‰µä½œæ­¥é©Ÿã€‚",
      "ç·´ç¿’å°è¡çªï¼šç”¨ã€æˆ‘æ„Ÿå—â€¦æˆ‘éœ€è¦â€¦ã€èªªæ¸…æ¥šã€‚",
      "æ‰¾ä¸€å€‹çœŸå¿ƒå–œæ­¡çš„ä¸»é¡Œï¼Œä½ æœƒçˆ†ç™¼ã€‚"
    ],
    loveTips: [
      "ä½ éœ€è¦è¢«å°Šé‡ï¼Œä¹Ÿè¦èªªå‡ºä½ çš„ç•Œç·šèˆ‡ä¸èˆ’æœã€‚",
      "å°æ–¹ä¸æ˜¯è®€å¿ƒå¸«ï¼šå„€å¼æ„Ÿèˆ‡æœŸå¾…è¦è¬›ã€‚",
      "è¡çªå…ˆé™æº«å†è«‡ï¼Œä¸è¦é å†·æ·¡è§£æ±ºã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„æº«æŸ”æ˜¯å¤©è³¦ï¼Œä½†ä½ ä¸éœ€è¦ç”¨å§”å±ˆæ›å’Œå¹³ã€‚"
  },

  INFP: {
    name: "å¤¢æƒ³è©©äººç†Š",
    tags: ["ç†æƒ³", "çœŸèª ", "æƒ³åƒåŠ›"],
    traits: "é‡è¦–åƒ¹å€¼èˆ‡å…§åœ¨ä¸€è‡´ï¼Œå–œæ­¡æœ‰æ„ç¾©çš„äº‹ã€‚",
    strengths: ["åŒç†èˆ‡å‰µæ„", "åƒ¹å€¼æ„Ÿæ¸…æ™°", "æº«æŸ”å …æŒ"],
    blindspots: ["å®¹æ˜“è‡ªè²¬", "æ€•è¢«å¦å®š", "æ‹–å»¶ä¾†è‡ªå®Œç¾ä¸»ç¾©"],
    work: ["å…§å®¹å‰µä½œ/æ–‡æ¡ˆ", "æ•™è‚²/åŠ©äºº", "å“ç‰Œ/ç¤¾ç¾¤/ä¼åŠƒ"],
    workTips: [
      "å…ˆåšç²—ç³™ç‰ˆå†è®Šå¥½ï¼Œä½ çš„æ‹–å»¶æœƒå°‘ä¸€åŠã€‚",
      "æŠŠç†æƒ³æ‹†æˆä»»å‹™ï¼šä»Šå¤©åªè¦å®Œæˆ 1 å°æ­¥ã€‚",
      "é¸å°ç’°å¢ƒå¾ˆé‡è¦ï¼šå°Šé‡ä½ åƒ¹å€¼çš„äººï¼Œä½ æœƒè¶…å¼·ã€‚"
    ],
    loveTips: [
      "åˆ¥ç”¨çŒœæ¸¬æŠ˜ç£¨è‡ªå·±ï¼šç”¨ç¢ºèªæ›å®‰å…¨æ„Ÿã€‚",
      "æŠŠæœŸå¾…èªªæ¸…æ¥šï¼šæˆ‘æƒ³è¦çš„å®‰å…¨æ„Ÿæ˜¯â€¦",
      "ä¸èˆ’æœå°±èªªï¼šä½ å¯ä»¥æº«æŸ”ï¼Œä¹Ÿå¯ä»¥å …å®šã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„å¿ƒå¾ˆç¾ï¼Œä¸ç”¨ç”¨ç—›è‹¦è­‰æ˜å®ƒçš„åƒ¹å€¼ã€‚"
  },

  INTP: {
    name: "æ€è¾¨ç ”ç©¶ç†Š",
    tags: ["åˆ†æ", "å¥½å¥‡", "é‚è¼¯"],
    traits: "å–œæ­¡æ¢ç´¢åŸç†èˆ‡çœŸç›¸ï¼Œæ“…é•·æ‹†è§£ç³»çµ±ã€‚",
    strengths: ["æŠ½è±¡æ€è€ƒ", "å‰µæ–°è§£æ³•", "å¿«é€Ÿå­¸ç¿’"],
    blindspots: ["ä¸æ„›è¢«å‚¬", "æƒ…ç·’å›æ‡‰æ…¢", "æƒ³å¤ªå¤šä¸åš"],
    work: ["ç ”ç™¼/è³‡æ–™/AI", "æ¶æ§‹/ç³»çµ±è¨­è¨ˆ", "ç ”ç©¶/é¡§å•/ç­–ç•¥"],
    workTips: [
      "ç”¨æ™‚é–“ç›’æ¨é€²ï¼š25 åˆ†é˜å…ˆåšå†èªªã€‚",
      "æºé€šå…ˆçµ¦çµè«–å†çµ¦æ¨ç†ï¼Œåˆ¥è®“äººè¿·è·¯ã€‚",
      "åˆ¥ç­‰éˆæ„Ÿï¼šå…ˆåšéª¨æ¶ï¼Œéˆæ„Ÿæœƒåœ¨è·¯ä¸Šå‡ºç¾ã€‚"
    ],
    loveTips: [
      "å…ˆå›ä¸€å¥ã€æˆ‘åœ¨æƒ³ã€ï¼Œåˆ¥è®“å°æ–¹ä»¥ç‚ºä½ å†·æ‰ã€‚",
      "æƒ…ç·’è­°é¡Œåˆ¥è¾¯è«–ï¼šæ”¹å•ã€ä½ å¸Œæœ›æˆ‘æ€éº¼åšï¼Ÿã€",
      "å›ºå®šç›¸è™•ç¯€å¥æœƒè®“ä½ æ›´å®‰å¿ƒã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒæƒ³ï¼Œä¹Ÿå€¼å¾—è¢«å¥½å¥½æ„Ÿå—ã€‚"
  },

  ESTP: {
    name: "è¡é‹’å†’éšªç†Š",
    tags: ["è¡Œå‹•", "æ‡‰è®Š", "å¸¶æ°£æ°›"],
    traits: "å–œæ­¡åˆºæ¿€èˆ‡æŒ‘æˆ°ï¼Œæ“…é•·å³æ™‚æ‡‰è®Šèˆ‡æ¨é€²ã€‚",
    strengths: ["è¡Œå‹•åŠ›å¼·", "å±æ©Ÿè™•ç†", "æ„ŸæŸ“åŠ›"],
    blindspots: ["è€å¿ƒä¸è¶³", "ä¸æ„›ç´°ç¯€", "è¡å‹•æ‰¿è«¾"],
    work: ["æ¥­å‹™/è«‡åˆ¤/BD", "æ´»å‹•/è¡ŒéŠ·", "ç¾å ´ç®¡ç†/ç‡Ÿé‹"],
    workTips: [
      "æŠŠã€è¡ã€é…ä¸Šæ”¶å°¾æ¸…å–®ï¼Œä½ æœƒæ›´ç„¡æ•µã€‚",
      "é‡è¦æ±ºç­–å…ˆåœ 10 åˆ†é˜ï¼šå•é¢¨éšªèˆ‡æ›¿ä»£æ–¹æ¡ˆã€‚",
      "ç›´æ¥ä¹Ÿè¦åŠ å°Šé‡ï¼šä¸€å¥ã€æˆ‘ç†è§£ä½ ã€å¾ˆåŠ åˆ†ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆæœƒå¸¶å°æ–¹é«”é©—äººç”Ÿï¼Œä¹Ÿè¦çµ¦å®‰å…¨æ„Ÿèˆ‡æ‰¿è«¾ã€‚",
      "åµæ¶åˆ¥ç”¨ç©ç¬‘å¸¶éï¼šå…ˆæ‰¿èªæ„Ÿå—å†è§£æ±ºã€‚",
      "ä½ éœ€è¦è‡ªç”±ï¼Œä¹Ÿè¦è®“å°æ–¹çŸ¥é“ä½ æœƒå›ä¾†ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ æ˜¯ç«ç®­ï¼Œä½†ä¹Ÿè¦è¨˜å¾—åŠ æ²¹èˆ‡å°èˆªã€‚"
  },

  ESFP: {
    name: "æ­¡æ¨‚èˆå°ç†Š",
    tags: ["ç†±æƒ…", "ç¤¾äº¤", "äº«å—"],
    traits: "å¸¶ä¾†å¿«æ¨‚èˆ‡é€£çµï¼Œé‡è¦–é«”é©—èˆ‡ç•¶ä¸‹æ„Ÿå—ã€‚",
    strengths: ["äººéš›é­…åŠ›", "æ°£æ°›è£½é€ ", "çœŸèª ç›´æ¥"],
    blindspots: ["æ€•ç„¡èŠ", "æƒ…ç·’åŒ–", "é•·æœŸè¦åŠƒå¼±"],
    work: ["æ´»å‹•/å…¬é—œ", "ä¸»æŒ/è¡¨æ¼”/å…§å®¹", "æœå‹™/é¡§å®¢é«”é©—"],
    workTips: [
      "ç”¨å°ç›®æ¨™ç¶­æŒå‹•åŠ›ï¼šæ¯é€±ä¸€å€‹äº®é»ä»»å‹™ã€‚",
      "ç”¨æ•…äº‹èªªæœï¼Œæ¯”ç¡¬è¬›æ›´å¼·ã€‚",
      "æ™‚é–“èˆ‡é‡‘éŒ¢è¨­åŸºæœ¬è¦å‰‡ï¼Œæ‰ä¸æœƒè¢«å¿«æ¨‚æ‹–ç´¯ã€‚"
    ],
    loveTips: [
      "æŠŠéœ€æ±‚è¬›æ¸…æ¥šï¼šæˆ‘æƒ³è¦ä½ å¤šå›æ‡‰/å¤šé™ªä¼´ã€‚",
      "è¡çªåˆ¥æ¸¬è©¦ï¼šå…ˆèªªã€æˆ‘ä¸èˆ’æœçš„é»æ˜¯â€¦ã€",
      "ä¸€èµ·å‰µé€ å›æ†¶ï¼Œä¹Ÿè¦ä¸€èµ·é¢å°ç¾å¯¦ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¸¶ä¾†å…‰ï¼Œä¹Ÿè¦è¨˜å¾—ä¿è­·è‡ªå·±çš„å…‰ã€‚"
  },

  ENFP: {
    name: "ç«èŠ±æ¢éšªç†Š",
    tags: ["å‰µæ„", "ç†±æƒ…", "å¯èƒ½æ€§"],
    traits: "é»å­å¤šã€å–œæ­¡é€£çµäººèˆ‡æ©Ÿæœƒï¼Œç†±æ„›æ¢ç´¢ã€‚",
    strengths: ["æ„ŸæŸ“åŠ›", "å‰µæ–°", "å¿«é€Ÿé€£çµ"],
    blindspots: ["åˆ†å¿ƒ", "è™é ­è›‡å°¾", "æƒ…ç·’èµ·ä¼"],
    work: ["å‰µæ„ä¼åŠƒ/è¡ŒéŠ·", "ç¤¾ç¾¤/å“ç‰Œ", "æ–°å‰µ/ç”¢å“æ¢ç´¢"],
    workTips: [
      "ä¸€æ¬¡åªæ¨é€² 1~2 æ¢ä¸»ç·šï¼šæ”¶æ–‚æ©Ÿåˆ¶å¾ˆé‡è¦ã€‚",
      "å»ºç«‹å®Œæˆå„€å¼ï¼šæ”¶å°¾æ¸…å–®ï¼‹æ…¶ç¥ 5 åˆ†é˜ã€‚",
      "ç”¨çœ‹æ¿è¿½è¹¤é€²åº¦ï¼Œåˆ¥åªæ”¾åœ¨è…¦å…§ã€‚"
    ],
    loveTips: [
      "ç”¨ç´„å®šå–ä»£æŸç¸›ï¼šè‡ªç”±ä¹Ÿéœ€è¦å®‰å…¨æ„Ÿã€‚",
      "å°‘çŒœæ¸¬ï¼Œå¤šç¢ºèªï¼šä½ æ˜¯ä¸æ˜¯åœ¨æ„â€¦ï¼Ÿ",
      "ä½æ½®æ™‚å…ˆèªªï¼šæˆ‘éœ€è¦é™ªä¼´/æˆ‘éœ€è¦ç¨è™•ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„å¯èƒ½æ€§å¾ˆå¤šï¼Œä½†ä½ ä¸éœ€è¦åŒæ™‚æˆç‚ºå…¨éƒ¨ã€‚"
  },

  ENTP: {
    name: "è¾¯è­‰ç™¼æ˜ç†Š",
    tags: ["æ©Ÿæ™º", "çªç ´", "é»å­"],
    traits: "å–œæ­¡æŒ‘æˆ°è§€é»ï¼Œæ“…é•·å‰µæ–°ã€è¾¯è­‰èˆ‡è«‡åˆ¤ã€‚",
    strengths: ["å‰µæ–°è§£æ³•", "èªªæœåŠ›", "å­¸ç¿’å¿«"],
    blindspots: ["å˜´å¿«å‚·äºº", "ä¸æ„›ä¾‹è¡Œ", "å¿½ç•¥æƒ…ç·’"],
    work: ["å‰µæ–°/ç­–ç•¥/é¡§å•", "ç”¢å“/å•†å‹™è«‡åˆ¤", "å‰µæ¥­/æ–°ä¼åŠƒ"],
    workTips: [
      "å…ˆè‚¯å®šå†ææŒ‘æˆ°ï¼šäººæœƒæ›´é¡˜æ„è·Ÿä½ ç«™åŒé‚Šã€‚",
      "æ‰¾æ”¶å°¾æµç¨‹æˆ–æ­æª”ï¼Œé¿å…å¡åœ¨é»å­æµ·ã€‚",
      "åˆ¥æŠŠåå°ç•¶æ¨‚è¶£ï¼šç”¨ã€ä¸€èµ·è®Šæ›´å¥½ã€çš„èªæ°£ã€‚"
    ],
    loveTips: [
      "è¾¯è«–ä¸æ˜¯æ„›ï¼šå°æ–¹è¦çš„æ˜¯è¢«ç†è§£ï¼Œä¸æ˜¯è¢«èªªæœã€‚",
      "å›ºå®šæ‰¿è«¾æœƒåŠ åˆ†ï¼šå†è‡ªç”±ä¹Ÿè¦è®“äººå®‰å¿ƒã€‚",
      "é“æ­‰åˆ¥åŠ ä½†æ›¸ï¼šæˆ‘å‰›å‰›è®“ä½ é›£å—äº†ï¼Œå°ä¸èµ·ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„è…¦å¾ˆé‹’åˆ©ï¼Œè¨˜å¾—ç”¨ä¾†åˆ‡é–‹å•é¡Œï¼Œä¸è¦åˆ‡åˆ°äººã€‚"
  },

  ESTJ: {
    name: "ç§©åºæŒ‡æ®ç†Š",
    tags: ["é ˜å°", "æ•ˆç‡", "è¦å‰‡"],
    traits: "é‡è¦–æ•ˆç‡èˆ‡æˆæœï¼Œæ“…é•·çµ„ç¹”ã€æ±ºç­–èˆ‡æ¨å‹•ã€‚",
    strengths: ["åŸ·è¡ŒåŠ›", "ç®¡ç†å”èª¿", "è²¬ä»»æ„Ÿ"],
    blindspots: ["å®¹æ˜“å¼·ç¡¬", "ä¸è€æ…¢", "å¿½ç•¥æƒ…ç·’æˆæœ¬"],
    work: ["ç®¡ç†è·/ç‡Ÿé‹", "å°ˆæ¡ˆ/æµç¨‹", "å•†å‹™/çµ„ç¹”ç®¡ç†"],
    workTips: [
      "ç”¨ã€ç›®æ¨™ä¸€è‡´ã€å–ä»£ã€ä½ è¦ç…§åšã€ï¼Œæ›´å¾—äººå¿ƒã€‚",
      "æŠŠå£«æ°£ç´å…¥ KPIï¼šæƒ…ç·’æˆæœ¬ä¹Ÿæ˜¯æˆæœ¬ã€‚",
      "å…ˆå•ï¼šä½ éœ€è¦æˆ‘æ€éº¼å¹«ï¼Ÿå†ä¸‹çµè«–ã€‚"
    ],
    loveTips: [
      "åˆ¥æŠŠæ„›è®Šæˆç®¡ç†ï¼šå¤šä¸€é»æº«æŸ”è‚¯å®šï¼Œå°‘ä¸€é»ç³¾æ­£ã€‚",
      "å…ˆè½å®Œï¼Œå†è«‡è§£æ³•èˆ‡è¦å‰‡ã€‚",
      "æŠŠæœŸå¾…è¬›æ¸…æ¥šï¼Œä¸è¦é»˜é»˜æ‰£åˆ†ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ èƒ½æ‰›äº‹ï¼Œä½†ä¸å¿…æ‰›æ‰€æœ‰äººçš„äººç”Ÿã€‚"
  },

  ESFJ: {
    name: "é—œä¿‚å®ˆè­·ç†Š",
    tags: ["ç…§é¡§", "å‡èš", "äº’åŠ©"],
    traits: "æ“…é•·ç…§é¡§åœ˜é«”æ°£æ°›ï¼Œé‡è¦–å’Œè«§èˆ‡æ­¸å±¬æ„Ÿã€‚",
    strengths: ["äººéš›ç¶“ç‡Ÿ", "åŒç†ç…§é¡§", "åœ˜éšŠå‡èš"],
    blindspots: ["æ€•è¢«æ‹’çµ•", "éåº¦ä»˜å‡º", "åœ¨æ„ä»–äººçœ¼å…‰"],
    work: ["äººè³‡/è¡Œæ”¿", "ç¤¾ç¾¤/å®¢æˆ¶é—œä¿‚", "æ•™è‚²/æœå‹™ç®¡ç†"],
    workTips: [
      "ä½ çš„å¼·é …æ˜¯ã€è®“å¤§å®¶æ›´å¥½ã€ï¼Œä¹Ÿè¦ç‚ºè‡ªå·±ä¿ç•™èƒ½é‡ã€‚",
      "æ‹’çµ•æ™‚çµ¦æ›¿ä»£æ–¹æ¡ˆï¼Œä¸å¿…ç¡¬åã€‚",
      "ç„¦æ…®æ™‚å›åˆ°äº‹å¯¦ï¼šæˆ‘ç¾åœ¨èƒ½åšçš„ä¸€æ­¥æ˜¯ï¼Ÿ"
    ],
    loveTips: [
      "èªªå‡ºéœ€æ±‚ï¼šæˆ‘æƒ³è¢«æ€éº¼æ„›ã€‚",
      "åˆ¥ç”¨ä»˜å‡ºæ›å®‰å…¨æ„Ÿï¼šç”¨æºé€šæ›ã€‚",
      "å°æ–¹å†·æ·¡æ™‚å…ˆç¢ºèªç‹€æ…‹ï¼Œä¸è¦å…ˆè‡ªè²¬ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒç…§äº®åˆ¥äººï¼Œä¹Ÿè¦è¨˜å¾—å¹«è‡ªå·±å……é›»ã€‚"
  },

  ENFJ: {
    name: "å¼•å°é ˜èˆªç†Š",
    tags: ["é¼“èˆ", "å¸¶äºº", "å…±æ„Ÿ"],
    traits: "æ“…é•·ç†è§£äººèˆ‡å¸¶å‹•æ”¹è®Šï¼Œé‡è¦–æˆé•·èˆ‡æ„ç¾©ã€‚",
    strengths: ["æ•™ç·´å‹é ˜å°", "é«˜åŒç†", "æ¿€å‹µä»–äºº"],
    blindspots: ["éåº¦æ“å¿ƒ", "é›£ä»¥æ”¾æ‰‹", "å¿½ç•¥è‡ªæˆ‘éœ€æ±‚"],
    work: ["ç®¡ç†/æ•™ç·´/åŸ¹è¨“", "å“ç‰Œ/å…¬é—œ", "ç¤¾ç¾¤/çµ„ç¹”ç™¼å±•"],
    workTips: [
      "ä½ çš„è²¬ä»»æ˜¯å¼•å°ï¼Œä¸æ˜¯æ‹¯æ•‘ï¼šåˆ¥æŠŠæ¯å€‹äººéƒ½æ‰›åœ¨èº«ä¸Šã€‚",
      "å…ˆå•ï¼šä½ æƒ³è¦å»ºè­°é‚„æ˜¯é™ªä¼´ï¼Ÿ",
      "å®‰æ’ç„¡ç¤¾äº¤æ™‚é–“ï¼Œä½ æœƒæ›´ç©©æ›´æœ‰èƒ½é‡ã€‚"
    ],
    loveTips: [
      "è®“å°æ–¹ä¹Ÿèƒ½ç‚ºä½ ä»˜å‡ºï¼šä½ ä¸å¿…ç¸½æ˜¯ç…§é¡§è€…ã€‚",
      "é¿å…ã€æˆ‘éƒ½ç‚ºä½ å¥½ã€ï¼Œæ”¹æˆã€ä½ éœ€è¦æˆ‘æ€éº¼é™ªä½ ã€ã€‚",
      "è¡çªæ™‚å›åˆ°å…±åŒç›®æ¨™ï¼šæˆ‘å€‘æƒ³æ›´é è¿‘ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ èƒ½å¸¶å¾ˆå¤šäººèµ°é ï¼Œä¹Ÿè¦è¨˜å¾—ç‰½èµ·è‡ªå·±çš„æ‰‹ã€‚"
  },

  ENTJ: {
    name: "ç‹åœ‹çµ±å¸¥ç†Š",
    tags: ["æ±ºç­–", "ç›®æ¨™", "æ¨é€²"],
    traits: "é‡è¦–æˆæœèˆ‡æ•ˆç‡ï¼Œæ“…é•·æ±ºç­–ã€æ•´åˆè³‡æºã€æ¨å‹•å‹åˆ©ã€‚",
    strengths: ["é ˜å°æ¨é€²", "ç­–ç•¥è¦åŠƒ", "æŠ—å£“å¼·"],
    blindspots: ["å¸¶å£“è¿«æ„Ÿ", "å¿½ç•¥æƒ…ç·’", "æŠŠé—œä¿‚ç•¶å°ˆæ¡ˆ"],
    work: ["é«˜éšç®¡ç†/ç‡Ÿé‹", "ç­–ç•¥/å•†æ¥­æ‹“å±•", "å‰µæ¥­/è² è²¬äºº"],
    workTips: [
      "å¤šåšä¸€æ¬¡å‚¾è½ï¼Œä½ çš„åœ˜éšŠæœƒå¤š 10 å€æˆ°åŠ›ã€‚",
      "æŠŠã€äººã€ç•¶å…±åŒé«”ï¼šæƒ…ç·’æ˜¯ç‡ƒæ–™ä¸æ˜¯é›œè¨Šã€‚",
      "é©åº¦å±•ç¾è„†å¼±ï¼Œå‡èšåŠ›åè€Œæ›´å¼·ã€‚"
    ],
    loveTips: [
      "å°æ–¹å¯èƒ½åªæƒ³è¢«æŠ±ä¸€ä¸‹ï¼šå…ˆå®‰æ’«å†è§£æ±ºã€‚",
      "æŠŠæœŸå¾…èªªæ¸…æ¥šï¼Œä¸è¦é»˜é»˜æ‰£åˆ†ã€‚",
      "ç”¨æº«åº¦è£œä¸Šæ•ˆç‡ï¼šç¢ºèªæ„Ÿå—æ¯”æŒ‡ä»¤æ›´æœ‰æ•ˆã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒè´ï¼Œä½†ä½ ä¹Ÿå€¼å¾—è¢«æº«æŸ”åœ°æ„›ã€‚"
  },

  // âœ… é€™å…©å€‹å¸¸è¢«å¿˜è¨˜ï¼šESTJ/ESFJ å·²æœ‰ï¼Œå‰©ä¸‹å…©å€‹ï¼šENFP/ENTP æœ‰äº†
  // âœ… ä¸‹é¢è£œé½Šï¼šISFP/ISTP/INTP/INFP/INFJ/INTJ/ISFJ/ISTJ éƒ½æœ‰
  // âœ… é‚„ç¼ºï¼šESFP/ESTP/ENFJ/ENTJ ä¹Ÿéƒ½æœ‰
  // âœ… ç›®å‰ 16 å‹å®Œæ•´
};

// =========================
// UI ç¶å®š
// =========================
const typeInput = document.getElementById("typeInput");
const goTypeBtn = document.getElementById("goTypeBtn");
const typeSelect = document.getElementById("typeSelect");
const randomBtn = document.getElementById("randomBtn");
const testUrl = document.getElementById("testUrl");
const openTestBtn = document.getElementById("openTestBtn");
const copyTypeBtn = document.getElementById("copyTypeBtn");
const swapPairBtn = document.getElementById("swapPairBtn");

const pairA = document.getElementById("pairA");
const pairB = document.getElementById("pairB");
const pairBtn = document.getElementById("pairBtn");
const pairSummary = document.getElementById("pairSummary");

const bearBtn = document.getElementById("bearBtn");
const bubble = document.getElementById("bubble");

const dockInstall = document.getElementById("dockInstall");

// Modalï¼šäººæ ¼
const modalType = document.getElementById("modalType");
const modalTypeTitle = document.getElementById("modalTypeTitle");
const modalTypeContent = document.getElementById("modalTypeContent");
const openDetailBtn = document.getElementById("openDetailBtn");

// Modalï¼šé…å°
const modalPair = document.getElementById("modalPair");
const modalPairContent = document.getElementById("modalPairContent");
const openPairDetailBtn = document.getElementById("openPairDetailBtn");

let pairMode = "work";
let deferredPrompt = null;

let currentType = "INFP";
let lastPairText = "";

// =========================
// åˆå§‹åŒ–ä¸‹æ‹‰
// =========================
const TYPES = Object.keys(MBTI).sort();

function fillSelect(sel) {
  sel.innerHTML = TYPES.map(t => `<option value="${t}">${t}ï½œ${MBTI[t].name}</option>`).join("");
}
fillSelect(typeSelect);
fillSelect(pairA);
fillSelect(pairB);

testUrl.value = DEFAULT_TEST_URL;

// =========================
// å·¥å…·ï¼šæ­£è¦åŒ– type
// =========================
function normalizeType(s) {
  return (s || "").trim().toUpperCase().replace(/[^A-Z]/g, "").slice(0, 4);
}

// =========================
// Modal æ§åˆ¶
// =========================
function openModal(el) {
  el.classList.add("show");
  el.setAttribute("aria-hidden", "false");
}
function closeModal(el) {
  el.classList.remove("show");
  el.setAttribute("aria-hidden", "true");
}

document.querySelectorAll("[data-close='1']").forEach(btn => {
  btn.addEventListener("click", () => {
    closeModal(modalType);
    closeModal(modalPair);
  });
});

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    closeModal(modalType);
    closeModal(modalPair);
  }
});

// =========================
// äººæ ¼å…§å®¹ï¼šå»º HTMLï¼ˆâœ… å¿…é ˆç”¨ innerHTML æ‰ä¸æœƒé¡¯ç¤º <div> æ–‡å­—ï¼‰
// =========================
function buildTypeHtml(t) {
  const d = MBTI[t];

  const pills = [
    `<span class="pill"><b>${t}</b>ï½œ${d.name}</span>`,
    ...(d.tags || []).map(x => `<span class="pill">âœ¨ ${x}</span>`)
  ].join("");

  const toList = (arr) => (arr && arr.length) ? `- ${arr.join("<br>- ")}` : "-ï¼ˆå¾…è£œï¼‰";

  return `
<div class="kv">${pills}</div>

<b>äººæ ¼ç‰¹è³ªï¼š</b> ${d.traits}<br><br>

<b>å„ªå‹¢ï¼š</b><br>${toList(d.strengths)}<br><br>

<b>å¯èƒ½ç›²é»ï¼š</b><br>${toList(d.blindspots)}<br><br>

<b>é©åˆå·¥ä½œ/é ˜åŸŸï¼š</b><br>${toList(d.work)}<br><br>

<b>è·å ´æé†’ï¼ˆæ›´é †ã€æ›´ä¸è€—èƒ½ï¼‰ï¼š</b><br>${toList(d.workTips)}<br><br>

<b>è¦ªå¯†é—œä¿‚å»ºè­°ï¼ˆæ›´é è¿‘ã€æ›´å®‰å¿ƒï¼‰ï¼š</b><br>${toList(d.loveTips)}<br><br>

<b>ç†Šç†Šæé†’ï¼š</b><br>${d.bear}
`.trim();
}

function setCurrentType(t) {
  if (!MBTI[t]) return;

  currentType = t;
  typeSelect.value = t;
  typeInput.value = t;

  modalTypeTitle.textContent = `ğŸ“˜ ${t}ï½œ${MBTI[t].name}`;
  modalTypeContent.innerHTML = buildTypeHtml(t);
}

// =========================
// æŸ¥è©¢äººæ ¼
// =========================
goTypeBtn.addEventListener("click", () => {
  const t = normalizeType(typeInput.value) || typeSelect.value;
  if (MBTI[t]) setCurrentType(t);
});

typeSelect.addEventListener("change", () => {
  setCurrentType(typeSelect.value);
});

typeInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") goTypeBtn.click();
});

randomBtn.addEventListener("click", () => {
  const t = TYPES[Math.floor(Math.random() * TYPES.length)];
  setCurrentType(t);
});

// äººæ ¼è©³ç´°è§£èªªå½ˆçª—
openDetailBtn.addEventListener("click", () => {
  openModal(modalType);
});

// =========================
// æ¸¬é©—å…¥å£
// =========================
openTestBtn.addEventListener("click", () => {
  const url = (testUrl.value || DEFAULT_TEST_URL).trim();
  if (!/^https?:\/\//i.test(url)) {
    alert("è«‹è¼¸å…¥ä»¥ http(s):// é–‹é ­çš„ç¶²å€");
    return;
  }
  window.open(url, "_blank", "noopener");
});

// è¤‡è£½ç›®å‰äººæ ¼
copyTypeBtn?.addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(currentType);
    bubble.textContent = `âœ… å·²è¤‡è£½ï¼š${currentType}ï¼ˆå¯è²¼çµ¦æœ‹å‹åšé…å°ï¼‰`;
  } catch (e) {}
});

// äº¤æ›é…å°
swapPairBtn?.addEventListener("click", () => {
  const a = pairA.value;
  pairA.value = pairB.value;
  pairB.value = a;
});

// =========================
// ç†Šç†Šæ°£æ³¡
// =========================
function randomBearLine() {
  return BEAR_QUOTES[Math.floor(Math.random() * BEAR_QUOTES.length)];
}

bearBtn.addEventListener("click", () => {
  bubble.textContent = randomBearLine();
});

// é•·æŒ‰è¤‡è£½æ°£æ³¡
bubble.addEventListener("pointerdown", () => {
  const timer = setTimeout(async () => {
    try {
      await navigator.clipboard.writeText(bubble.textContent);
      bubble.textContent = "âœ… å·²è¤‡è£½ï¼";
      setTimeout(() => bubble.textContent = randomBearLine(), 900);
    } catch (e) {}
  }, 520);

  const up = () => {
    clearTimeout(timer);
    window.removeEventListener("pointerup", up);
    window.removeEventListener("pointercancel", up);
  };
  window.addEventListener("pointerup", up);
  window.addEventListener("pointercancel", up);
});

// =========================
// é…å°åˆ†æ
// =========================
function diffLetters(a, b) {
  const pairs = [
    ["E", "I", "èƒ½é‡ä¾†æºï¼ˆå¤–å‘/å…§å‘ï¼‰"],
    ["S", "N", "è³‡è¨Šåå¥½ï¼ˆç´°ç¯€/å¯èƒ½æ€§ï¼‰"],
    ["T", "F", "æ±ºç­–åå¥½ï¼ˆé‚è¼¯/æ„Ÿå—ï¼‰"],
    ["J", "P", "ç”Ÿæ´»ç¯€å¥ï¼ˆè¨ˆç•«/å½ˆæ€§ï¼‰"]
  ];
  const diffs = [];
  for (const [x, y, label] of pairs) {
    const ia = a.includes(x) ? x : y;
    const ib = b.includes(x) ? x : y;
    if (ia !== ib) diffs.push({ label, a: ia, b: ib });
  }
  return diffs;
}

function pairingAdvice(a, b, mode) {
  const diffs = diffLetters(a, b);
  const sameCount = 4 - diffs.length;

  const scoreWord =
    sameCount === 4 ? "é»˜å¥‘å¾ˆé«˜" :
    sameCount === 3 ? "é»˜å¥‘åé«˜" :
    sameCount === 2 ? "äº’è£œå‹" :
    sameCount === 1 ? "å·®ç•°å¾ˆå¤§ä½†å¯äº’è£œ" :
    "å®Œå…¨äº’è£œï¼ˆéœ€è¦åˆ»æ„ç·´ç¿’ï¼‰";

  let lines = [];
  lines.push(`Aï¼š${a}ï½œ${MBTI[a].name}`);
  lines.push(`Bï¼š${b}ï½œ${MBTI[b].name}`);
  lines.push(`\næ•´é«”æ„Ÿè¦ºï¼š${scoreWord}`);
  lines.push(`å·®ç•°é»ï¼š${diffs.length ? "" : "å¹¾ä¹åŒé »"}`);

  if (diffs.length) {
    for (const d of diffs) {
      lines.push(`- ${d.label}ï¼šA(${d.a}) vs B(${d.b})`);
    }
  }

  if (mode === "work") {
    lines.push(`\nã€è·å ´ç›¸è™•æ€éº¼æ›´é †ã€‘`);
    if (diffs.some(x => x.label.includes("è³‡è¨Šåå¥½"))) {
      lines.push(`- ä¸€ä½æ„›ç´°ç¯€ã€ä¸€ä½æ„›æ–¹å‘ï¼šå…ˆå®šç¾©ã€æˆæœé•·ä»€éº¼æ¨£ã€å†åˆ†å·¥ï¼ˆæ¡†æ¶/ç´°ç¯€ï¼‰ã€‚`);
    }
    if (diffs.some(x => x.label.includes("æ±ºç­–åå¥½"))) {
      lines.push(`- ä¸€ä½é‡é‚è¼¯ã€ä¸€ä½é‡æ„Ÿå—ï¼šå…ˆè¬›ã€äº‹å¯¦èˆ‡é¸é …ã€å†è¬›ã€å½±éŸ¿åˆ°èª°ã€ã€‚`);
    }
    if (diffs.some(x => x.label.includes("ç”Ÿæ´»ç¯€å¥"))) {
      lines.push(`- ä¸€ä½æ„›è¨ˆç•«ã€ä¸€ä½æ„›å½ˆæ€§ï¼šç”¨ã€æœ€å°å¿…è¦è¦å‰‡ã€ï¼ˆæˆªæ­¢æ—¥/è²¬ä»»äººï¼‰ï¼Œå…¶ä»–çµ¦è‡ªç”±ã€‚`);
    }
    if (diffs.some(x => x.label.includes("èƒ½é‡ä¾†æº"))) {
      lines.push(`- ä¸€ä½éœ€è¦è¨è«–ã€ä¸€ä½éœ€è¦ç¨è™•ï¼šå…ˆçµ¦æ™‚é–“æƒ³ï¼Œå†ç´„å›ºå®šå°é½Šé»ã€‚`);
    }
    lines.push(`- ç†Šç†Šå°æ‹›ï¼šå…ˆå•ä¸€å¥ã€Œä½ æƒ³å…ˆè«‡æ–¹å‘é‚„æ˜¯å…ˆå°ç´°ç¯€ï¼Ÿã€`);
  } else {
    lines.push(`\nã€è¦ªå¯†é—œä¿‚æ€éº¼æ›´é è¿‘ã€‘`);
    if (diffs.some(x => x.label.includes("èƒ½é‡ä¾†æº"))) {
      lines.push(`- å¤–å‘è¦äº’å‹•ã€å…§å‘è¦å……é›»ï¼šå»ºç«‹å¯é æœŸç¯€å¥ï¼ˆç›¸è™•ï¼‹å„è‡ªæ™‚é–“éƒ½è¦ï¼‰ã€‚`);
    }
    if (diffs.some(x => x.label.includes("æ±ºç­–åå¥½"))) {
      lines.push(`- è¡çªé †åºï¼šå…ˆå®‰æ’« â†’ å†è¨è«– â†’ å†è¡Œå‹•ï¼ˆå…ˆè¢«ç†è§£æ‰è«‡è§£æ³•ï¼‰ã€‚`);
    }
    if (diffs.some(x => x.label.includes("ç”Ÿæ´»ç¯€å¥"))) {
      lines.push(`- è¨ˆç•«æ´¾è¦æ‰¿è«¾ã€å½ˆæ€§æ´¾è¦è‡ªç”±ï¼šç”¨ã€ç´„å®šã€å–ä»£ã€æ§åˆ¶ã€ã€‚`);
    }
    if (diffs.some(x => x.label.includes("è³‡è¨Šåå¥½"))) {
      lines.push(`- ç´°ç¯€æ´¾è¦è¸å¯¦ã€ç›´è¦ºæ´¾è¦é¡˜æ™¯ï¼šä¸€å€‹èªªã€æˆ‘éœ€è¦ä»€éº¼ã€ä¸€å€‹èªªã€æˆ‘æƒ³å»å“ªè£¡ã€ã€‚`);
    }
    lines.push(`- ç†Šç†Šå°æ‹›ï¼šæ¯å¤©ä¸€å¥ç¢ºèªã€Œæˆ‘ä»Šå¤©æœ€éœ€è¦çš„æ˜¯é™ªä¼´/ç©ºé–“/è‚¯å®š/ç†è§£ï¼Ÿã€`);
  }

  lines.push(`\nğŸ» ç†Šç†Šæé†’ï¼šç›¸å®¹ä¸æ˜¯å¤©ç”Ÿï¼Œæ˜¯ä¸€èµ·ç·´å‡ºä¾†çš„é»˜å¥‘ã€‚`);
  return lines.join("\n");
}

pairBtn.addEventListener("click", () => {
  const a = pairA.value;
  const b = pairB.value;

  lastPairText = pairingAdvice(a, b, pairMode);

  // ä¸»ç•«é¢åªé¡¯ç¤ºæ‘˜è¦ï¼ˆå‰ 6 è¡Œï¼‰
  const summary = lastPairText.split("\n").slice(0, 6).join("\n");
  pairSummary.textContent = summary + "\nâ€¦ï¼ˆé»ä¸‹é¢çœ‹å®Œæ•´ï¼‰";

  // å½ˆçª—å®Œæ•´å…§å®¹
  modalPairContent.textContent = lastPairText;
});

// é–‹å•Ÿé…å°å®Œæ•´å…§å®¹å½ˆçª—
openPairDetailBtn.addEventListener("click", () => {
  if (!lastPairText) {
    alert("è«‹å…ˆæŒ‰ã€Œåˆ†æã€ç”¢ç”Ÿé…å°å…§å®¹");
    return;
  }
  openModal(modalPair);
});

// åˆ‡æ›è·å ´/è¦ªå¯†
document.querySelectorAll(".seg-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".seg-btn").forEach(x => x.classList.remove("active"));
    btn.classList.add("active");
    pairMode = btn.dataset.mode;
  });
});

// =========================
// PWA å®‰è£ï¼ˆAndroid å¸¸ç”¨ï¼‰
// =========================
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  dockInstall.textContent = "â• æ–°å¢åˆ°ä¸»ç•«é¢";
});

dockInstall.addEventListener("click", async () => {
  if (!deferredPrompt) {
    alert("iPhoneï¼šSafari â†’ åˆ†äº« â†’ åŠ åˆ°ä¸»ç•«é¢ã€‚\nAndroidï¼šå³ä¸Šè§’é¸å–®å¯å®‰è£ / æˆ–æœƒè·³å‡ºå®‰è£æç¤ºã€‚");
    return;
  }
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  deferredPrompt = null;
  dockInstall.textContent = choice?.outcome === "accepted" ? "âœ… å·²åŠ å…¥" : "â• æ–°å¢åˆ°ä¸»ç•«é¢";
});

// =========================
// Service Worker
// =========================
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js").catch(() => {});
  });
}

// =========================
// åˆå§‹ç‹€æ…‹
// =========================
setCurrentType("INFP");
typeSelect.value = "INFP";
typeInput.value = "INFP";