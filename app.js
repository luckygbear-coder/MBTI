// =========================
// MBTIç†Š - ä¸»ç¨‹å¼
// =========================

// ä½ å¯ä»¥æŠŠæ¸¬é©—ç¶²ç«™é è¨­æ”¾åœ¨é€™è£¡ï¼ˆæˆ–è®“ä½¿ç”¨è€…åœ¨ UI å¡«ï¼‰
const DEFAULT_TEST_URL = "https://www.16personalities.com/";

// ç†Šç†Šé»æ“Šéš¨æ©Ÿèªå¥/å•é¡Œ
const BEAR_QUOTES = [
  "ğŸ» ä½ ç¾åœ¨æœ€æƒ³è¢«ç†è§£çš„æ˜¯å“ªä¸€ä»¶äº‹ï¼Ÿ",
  "ğŸ» ä½ ä»Šå¤©åšå¾—æœ€æ£’çš„ä¸€ä»¶å°äº‹æ˜¯ä»€éº¼ï¼Ÿ",
  "ğŸ» å¦‚æœæŠŠä½ ç•¶æˆä¸€ä½å†’éšªè€…ï¼Œä½ çš„ã€è£œçµ¦å“ã€æ˜¯ä»€éº¼ï¼Ÿï¼ˆç¡çœ /æœ‹å‹/é‹å‹•/å‰µä½œâ€¦ï¼‰",
  "ğŸ» ä½ æœ€è¿‘æœ€å¸¸å¡ä½çš„æƒ…ç·’æ˜¯ï¼šç„¦æ…®ã€å§”å±ˆã€ç”Ÿæ°£ã€ç©ºè™›ã€ç–²æ†Šï¼Œå“ªä¸€å€‹ï¼Ÿ",
  "ğŸ» ä½ æƒ³æˆç‚ºã€æ›´å¥½çš„è‡ªå·±ã€ï¼Œæ˜¯æƒ³æ›´å‹‡æ•¢ï¼Ÿæ›´æº«æŸ”ï¼Ÿæ›´æœ‰ç•Œç·šï¼Ÿ",
  "ğŸ» ä½ é¡˜æ„åœä¸‹ä¾†çœ‹è‡ªå·±ï¼Œé€™å°±å¾ˆäº†ä¸èµ·äº†ã€‚",
  "ğŸ» ä¸æ˜¯è¦è®Šæˆåˆ¥äººï¼Œæ˜¯æŠŠè‡ªå·±ç”¨å¾—æ›´é †ã€æ›´èˆ’æœã€‚",
  "ğŸ» ä½ æƒ³è¦çš„é—œä¿‚ï¼Œæ˜¯è¢«ç…§é¡§ï¼Ÿè¢«å°Šé‡ï¼Ÿè¢«ç†è§£ï¼Ÿé‚„æ˜¯ä¸€èµ·æˆé•·ï¼Ÿ"
];

// 16 å‹è³‡æ–™ï¼ˆå¯å†åŠ é•·ï¼‰
const MBTI = {
  ISTJ: {
    name: "ç‰©æµå®ˆè­·ç†Š",
    tags: ["å‹™å¯¦", "å®ˆè¦", "å¯é "],
    traits: "é‡è¦–ç§©åºèˆ‡è²¬ä»»ï¼Œåå¥½æ¸…æ¥šè¦å‰‡èˆ‡å¯é æœŸæµç¨‹ã€‚",
    strengths: ["ç©©å®šå¯é ", "æŠŠäº‹åšå®Œ", "é¢¨éšªæ§ç®¡"],
    blindspots: ["å°è®Šå‹•è¼ƒç„¦æ…®", "å®¹æ˜“å°æ¨™æº–éåš´", "æƒ…ç·’è¡¨é”è¼ƒå«è“„"],
    work: ["è¡Œæ”¿/æ³•å‹™/ç¨½æ ¸", "å°ˆæ¡ˆç®¡æ§/PMO", "å“è³ªç®¡ç†/æµç¨‹æ”¹å–„"],
    workTips: [
      "å…ˆæŠŠç›®æ¨™æ‹†æˆã€å¯æª¢æ ¸é‡Œç¨‹ç¢‘ã€ï¼Œä½ çš„æ•ˆç‡æœƒæ›´å¯æ€•ã€‚",
      "é‡åˆ°è®Šæ›´åˆ¥æ€¥è‘—å¦å®šï¼šå…ˆå•ã€é¢¨éšªæ˜¯ä»€éº¼ï¼Ÿæˆ‘éœ€è¦å“ªäº›è³‡è¨Šï¼Ÿã€",
      "çµ¦è‡ªå·±ç•™ 10% å½ˆæ€§ï¼Œä¸å¿…æ¯ä»¶äº‹éƒ½åšåˆ° 100 åˆ†æ‰ç®—å¥½ã€‚"
    ],
    loveTips: [
      "ä½ è¡¨é”æ„›å¸¸ç”¨ã€ç…§é¡§/è² è²¬ã€ï¼Œä¹Ÿå¯ä»¥ç·´ç¿’èªªå‡ºæ„Ÿå—ã€‚",
      "åˆ¥æŠŠå°æ–¹çš„é¬†æ•£è¦–ç‚ºä¸åœ¨ä¹ï¼Œå…ˆè«‡ã€æœŸå¾…èˆ‡ç•Œç·šã€ã€‚",
      "å›ºå®šçš„ç›¸è™•å„€å¼ï¼ˆæ¯é€±ç´„æœƒ/æ¯æ—¥ 10 åˆ†é˜èŠå¤©ï¼‰å¾ˆé©åˆä½ ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ æ˜¯å¾ˆå¯é çš„é å±±ï¼Œä½†ä½ ä¹Ÿå€¼å¾—è¢«ç…§é¡§ã€‚"
  },

  ISFJ: {
    name: "æš–å¿ƒç…§è­·ç†Š",
    tags: ["é«”è²¼", "ç´°è†©", "å®ˆè­·"],
    traits: "é‡è¦–é—œä¿‚èˆ‡æ‰¿è«¾ï¼Œæ“…é•·ç…§é¡§ä»–äººã€è¨˜å¾—ç´°ç¯€ã€‚",
    strengths: ["é«˜åŒç†", "é»˜é»˜ä»˜å‡º", "ç©©å®šæ”¯æŒ"],
    blindspots: ["ä¸æ•¢æ‹’çµ•", "å®¹æ˜“å§”å±ˆç´¯ç©", "éåº¦åœ¨æ„è©•åƒ¹"],
    work: ["äººè³‡/å®¢æœ/ç…§è­·", "æ•™å­¸/è¡Œæ”¿æ”¯æ´", "ç‡Ÿé‹/å®¢æˆ¶æˆåŠŸ"],
    workTips: [
      "å…ˆå­¸æœƒèªªã€æˆ‘éœ€è¦æƒ³ä¸€ä¸‹ã€ï¼Œé€™æ˜¯æº«æŸ”çš„ç•Œç·šã€‚",
      "æŠŠä½ çš„ä»˜å‡ºã€å¯è¦–åŒ–ã€ï¼šç”¨æ¸…å–®/å›å ±ï¼Œè®“åƒ¹å€¼è¢«çœ‹è¦‹ã€‚",
      "é‡åˆ°è¡çªå…ˆå¯«ä¸‹éœ€æ±‚ï¼šæˆ‘æƒ³è¦ä»€éº¼ï¼Ÿæˆ‘å®³æ€•ä»€éº¼ï¼Ÿ"
    ],
    loveTips: [
      "åˆ¥åªåšä¸èªªï¼Œç·´ç¿’æå‡ºéœ€æ±‚ï¼šã€æˆ‘å¸Œæœ›ä½ â€¦ã€",
      "ä½ å¾ˆæœƒç…§é¡§äººï¼Œä¹Ÿè¦å…è¨±å°æ–¹ç…§é¡§ä½ ã€‚",
      "ç•¶ä½ æƒ³å¿è€æ™‚ï¼Œå…ˆå•ï¼šé€™æ˜¯æ„›ï¼Ÿé‚„æ˜¯å®³æ€•å¤±å»ï¼Ÿ"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šæº«æŸ”ä¸æ˜¯å¿è€ï¼Œæº«æŸ”ä¹Ÿå¯ä»¥å¾ˆæœ‰ç•Œç·šã€‚"
  },

  INFJ: {
    name: "é è¨€å¼•è·¯ç†Š",
    tags: ["æ´å¯Ÿ", "ç†æƒ³", "æ·±åº¦"],
    traits: "æ´å¯Ÿäººå¿ƒèˆ‡è¶¨å‹¢ï¼Œé‡è¦–æ„ç¾©èˆ‡é•·æœŸæ–¹å‘ã€‚",
    strengths: ["çœ‹è¦‹æœ¬è³ª", "æ•´åˆé¡˜æ™¯", "åŒç†èˆ‡å¼•å°"],
    blindspots: ["æƒ³å¤ªå¤šè€—èƒ½", "å°åƒ¹å€¼è§€å¾ˆæ•æ„Ÿ", "å®¹æ˜“æ‚¶è‘—ä¸èªª"],
    work: ["å“ç‰Œ/å…§å®¹ç­–ç•¥", "é¡§å•/æ•™ç·´/å¿ƒç†åŠ©äºº", "ç ”ç©¶/è¨­è¨ˆæ€è€ƒ"],
    workTips: [
      "æŠŠç›´è¦ºè½åœ°ï¼šç”¨ã€ä¸‹ä¸€æ­¥å¯è¡Œå‹•ã€æ”¶æ–‚ç„¦æ…®ã€‚",
      "åˆ¥æŠŠè²¬ä»»å…¨æ‰›ï¼šæ¸…æ¥šåˆ†å·¥èƒ½ä¿è­·ä½ çš„èƒ½é‡ã€‚",
      "ç•¶ä½ æƒ³æ¶ˆå¤±æ™‚ï¼Œå…ˆè£œèƒ½ï¼ˆç¡çœ /æ•£æ­¥/å®‰éœï¼‰å†æ±ºå®šã€‚"
    ],
    loveTips: [
      "ä½ è¦çš„æ˜¯ã€éˆé­‚å±¤æ¬¡çš„ç†è§£ã€ï¼Œå…ˆè¬›æ¸…æ¥šä½ åœ¨ä¹çš„åƒ¹å€¼ã€‚",
      "åˆ¥ç”¨æš—ç¤ºæ¸¬è©¦å°æ–¹ï¼Œç›´æ¥èªªï¼šæˆ‘å¸Œæœ›ä½ æ€éº¼åšã€‚",
      "ç·´ç¿’æŠŠæœŸå¾…åˆ†ç´šï¼šå¿…è¦/åŠ åˆ†/å¯æœ‰å¯ç„¡ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæ·±ï¼Œä½†ä¸ç”¨æ¯æ¬¡éƒ½æ½›æ°´åˆ°åº•ï¼Œæµ®ä¸Šä¾†ä¹Ÿå¾ˆå®‰å…¨ã€‚"
  },

  INTJ: {
    name: "ç­–ç•¥è»å¸«ç†Š",
    tags: ["ç­–ç•¥", "ç¨ç«‹", "é«˜æ¨™"],
    traits: "æ“…é•·ç³»çµ±åŒ–èˆ‡é•·æœŸè¦åŠƒï¼Œå–œæ­¡æœ‰æ•ˆç‡çš„è§£æ³•ã€‚",
    strengths: ["è¦åŠƒåŠ›å¼·", "åˆ¤æ–·ç²¾æº–", "è‡ªæˆ‘é©…å‹•"],
    blindspots: ["å°ä½æ•ˆç‡æ•æ„Ÿ", "æƒ…ç·’è¡¨é”è¼ƒç›´æ¥/å†·", "ä¸æ„›æ±‚åŠ©"],
    work: ["ç”¢å“/ç­–ç•¥/æ•¸æ“š", "ç ”ç™¼/å·¥ç¨‹/æ¶æ§‹", "æŠ•ç ”/å•†æ¥­åˆ†æ"],
    workTips: [
      "ç”¨ã€å½±éŸ¿åŠ›ã€è€Œä¸æ˜¯ã€æ­£ç¢ºæ€§ã€ä¾†æºé€šï¼Œæœƒæ›´å¿«è¢«æ¡ç´ã€‚",
      "å»ºç«‹å›é¥‹è¿´è·¯ï¼šå®šæœŸè½ä½¿ç”¨è€…/åŒäº‹çš„çœŸå¯¦ç—›é»ã€‚",
      "å¶çˆ¾æ”¾éä¸å®Œç¾ï¼šå…ˆåšåˆ° 70% å†è¿­ä»£ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆé‡è¦–å°Šé‡èˆ‡ç©ºé–“ï¼Œè¨˜å¾—ä¹Ÿçµ¦ã€æƒ…ç·’ä¸Šçš„å›æ‡‰ã€ã€‚",
      "æŠŠã€æˆ‘åœ¨æƒ³ã€è®Šæˆã€æˆ‘åœ¨ä¹ã€ï¼šä¸€å¥ç¢ºèªå°±å¾ˆåŠ åˆ†ã€‚",
      "è¡çªæ™‚å…ˆèªªç›®çš„ï¼šæˆ‘æƒ³æŠŠæˆ‘å€‘è®Šæ›´å¥½ï¼Œä¸æ˜¯è¦è´ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„è…¦å¾ˆå¼·ï¼Œä½†ä½ çš„å¿ƒä¹Ÿå¾ˆé‡è¦ã€‚"
  },

  ISTP: {
    name: "æ©Ÿå·§æ¢ç´¢ç†Š",
    tags: ["å†·éœ", "å‹•æ‰‹", "è‡¨å ´"],
    traits: "å–œæ­¡å¯¦ä½œèˆ‡è§£æ±ºå•é¡Œï¼Œè‡¨å ´åæ‡‰å¿«ã€‚",
    strengths: ["æ’é™¤æ•…éšœ", "å¯¦å‹™å°å‘", "æŠ—å£“"],
    blindspots: ["ä¸æ„›å†—é•·æºé€š", "å°æ‰¿è«¾å£“åŠ›å¤§", "æƒ…ç·’æ™šåˆ°"],
    work: ["å·¥ç¨‹/ç¶­é‹/è³‡å®‰", "æŠ€è¡“æ”¯æ´/ä¿®å¾©", "å·¥æ¥­è¨­è¨ˆ/å·¥å…·é¡"],
    workTips: [
      "æŠŠæƒ³æ³•ç”¨ Demo èªªè©±ï¼Œä½ æœ€æœ‰èªªæœåŠ›ã€‚",
      "é‡è¦è³‡è¨Šè¨˜éŒ„ä¸‹ä¾†ï¼ˆå‚™å¿˜/çœ‹æ¿ï¼‰ï¼Œé¿å…ã€å£é ­è’¸ç™¼ã€ã€‚",
      "é‡åˆ°äººéš›æ‘©æ“¦ï¼šå…ˆè¬›äº‹å¯¦+éœ€æ±‚ï¼Œå°‘ç”¨çµè«–å¼èªæ°£ã€‚"
    ],
    loveTips: [
      "ä½ è¡¨é”æ„›åè¡Œå‹•æ´¾ï¼Œå¶çˆ¾åŠ ä¸€å¥è‚¯å®šæœƒæ›´ç”œã€‚",
      "åˆ¥é»˜é»˜æ¶ˆå¤±ï¼Œç°¡çŸ­èªªæ˜ï¼šæˆ‘éœ€è¦ä¸€é»æ™‚é–“å†·éœã€‚",
      "ä¸€èµ·åšäº‹ï¼ˆé‹å‹•/æ—…è¡Œ/æ‰‹ä½œï¼‰æ¯”ä¸€ç›´è«‡å¿ƒæ›´é©åˆä½ ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆå¼·çš„åœ°æ–¹æ˜¯ã€æŠŠå•é¡Œè®Šç°¡å–®ã€ï¼Œä¹Ÿåˆ¥å¿˜äº†æŠŠæ„Ÿå—èªªç°¡å–®ã€‚"
  },

  ISFP: {
    name: "æ„Ÿå—è—è¡“ç†Š",
    tags: ["æº«æŸ”", "å¯©ç¾", "è‡ªç”±"],
    traits: "é‡è¦–æ„Ÿå—èˆ‡çœŸèª ï¼Œå–œæ­¡åšè‡ªå·±ã€æœ‰ç¾æ„Ÿã€‚",
    strengths: ["åŒç†æº«æš–", "å¯©ç¾èˆ‡è¡¨é”", "æ´»åœ¨ç•¶ä¸‹"],
    blindspots: ["è¨å­è¡çª", "æ±ºç­–æ˜“çŒ¶è±«", "å£“åŠ›å¤§æœƒé€ƒèµ°"],
    work: ["è¨­è¨ˆ/å½±åƒ/æ’ç•«", "æœå‹™é«”é©—/é¤æ—…", "ç…§è­·/æ•™è‚²æ´»å‹•"],
    workTips: [
      "æŠŠéˆæ„Ÿè®Šæµç¨‹ï¼šå»ºç«‹ã€å¯é‡è¤‡çš„å‰µä½œæ­¥é©Ÿã€ã€‚",
      "å­¸æœƒå°è¡çªï¼šç”¨ã€æˆ‘æ„Ÿå—â€¦æˆ‘éœ€è¦â€¦ã€èªªæ¸…æ¥šã€‚",
      "æ‰¾ä¸€å€‹ä½ çœŸçš„å–œæ­¡çš„æ ¸å¿ƒä¸»é¡Œï¼Œä½ æœƒçˆ†ç™¼ã€‚"
    ],
    loveTips: [
      "ä½ éœ€è¦è¢«å°Šé‡èˆ‡è¢«æº«æŸ”å°å¾…ï¼Œä¹Ÿè¦èªªå‡ºä½ çš„ç•Œç·šã€‚",
      "å°æ–¹ä¸æ˜¯è®€å¿ƒå¸«ï¼šä½ æƒ³è¦çš„å„€å¼æ„Ÿè¦è¬›ã€‚",
      "è¡çªå…ˆé™æº«å†è«‡ï¼Œä¸è¦é å†·æ·¡è§£æ±ºã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„æº«æŸ”æ˜¯å¤©è³¦ï¼Œä½†ä½ ä¸éœ€è¦ç”¨å§”å±ˆæ›å’Œå¹³ã€‚"
  },

  INFP: {
    name: "å¤¢æƒ³è©©äººç†Š",
    tags: ["ç†æƒ³", "çœŸèª ", "æƒ³åƒåŠ›"],
    traits: "é‡è¦–åƒ¹å€¼èˆ‡å…§åœ¨ä¸€è‡´ï¼Œå–œæ­¡æœ‰æ„ç¾©çš„äº‹ã€‚",
    strengths: ["åŒç†èˆ‡å‰µæ„", "åƒ¹å€¼æ„Ÿæ¸…æ™°", "æº«æŸ”å …æŒ"],
    blindspots: ["å®¹æ˜“è‡ªè²¬", "æ€•è¢«å¦å®š", "æ‹–å»¶ä¾†è‡ªå®Œç¾ä¸»ç¾©"],
    work: ["å…§å®¹å‰µä½œ/æ–‡æ¡ˆ", "æ•™è‚²/åŠ©äººå·¥ä½œ", "å“ç‰Œ/ç¤¾ç¾¤/ä¼åŠƒ"],
    workTips: [
      "å…ˆåšã€ç²—ç³™ç‰ˆã€å†è®Šå¥½ï¼Œä½ çš„æ‹–å»¶æœƒå°‘ä¸€åŠã€‚",
      "æŠŠç†æƒ³æ‹†æˆä»»å‹™ï¼šä»Šå¤©åªè¦å®Œæˆ 1 å°æ­¥ã€‚",
      "é¸å°ç’°å¢ƒå¾ˆé‡è¦ï¼šå°Šé‡ä½ åƒ¹å€¼çš„äººï¼Œä½ æœƒè¶…å¼·ã€‚"
    ],
    loveTips: [
      "ä½ éœ€è¦è¢«ç†è§£èˆ‡è¢«çæƒœï¼Œåˆ¥ç”¨çŒœæ¸¬æŠ˜ç£¨è‡ªå·±ã€‚",
      "æŠŠæœŸå¾…èªªæ¸…æ¥šï¼šæˆ‘æƒ³è¦çš„å®‰å…¨æ„Ÿæ˜¯â€¦",
      "ä½ å¯ä»¥æº«æŸ”ï¼Œä½†ä¹Ÿå¯ä»¥å …å®šï¼šä¸èˆ’æœå°±èªªã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„å¿ƒå¾ˆç¾ï¼Œä¸ç”¨ç”¨ç—›è‹¦è­‰æ˜å®ƒçš„åƒ¹å€¼ã€‚"
  },

  INTP: {
    name: "æ€è¾¨ç ”ç©¶ç†Š",
    tags: ["åˆ†æ", "å¥½å¥‡", "é‚è¼¯"],
    traits: "å–œæ­¡æ¢ç´¢åŸç†èˆ‡çœŸç›¸ï¼Œæ“…é•·æ‹†è§£ç³»çµ±ã€‚",
    strengths: ["æŠ½è±¡æ€è€ƒ", "å‰µæ–°è§£æ³•", "å¿«é€Ÿå­¸ç¿’"],
    blindspots: ["ä¸æ„›è¢«å‚¬", "æƒ…ç·’å›æ‡‰æ…¢", "å®¹æ˜“æƒ³å¤ªå¤šä¸åš"],
    work: ["ç ”ç™¼/è³‡æ–™/AI", "æ¶æ§‹/ç³»çµ±è¨­è¨ˆ", "ç ”ç©¶/é¡§å•/ç­–ç•¥"],
    workTips: [
      "ç”¨ã€æ™‚é–“ç›’ã€æ¨é€²ï¼šä¾‹å¦‚ 25 åˆ†é˜å…ˆåšå†èªªã€‚",
      "æºé€šå…ˆçµ¦çµè«–å†çµ¦æ¨ç†ï¼Œåˆ¥è®“äººè¿·è·¯ã€‚",
      "åˆ¥ç­‰éˆæ„Ÿï¼šå…ˆåšéª¨æ¶ï¼Œéˆæ„Ÿæœƒåœ¨è·¯ä¸Šå‡ºç¾ã€‚"
    ],
    loveTips: [
      "ä½ ä¸æ˜¯ä¸åœ¨ä¹ï¼Œåªæ˜¯åæ‡‰æ…¢ï¼šå¯ä»¥å…ˆå›ä¸€å¥ã€æˆ‘åœ¨æƒ³ã€ã€‚",
      "æƒ…ç·’è­°é¡Œåˆ¥ç”¨è¾¯è«–è´ï¼Œæ”¹ç”¨ç†è§£ï¼šä½ å¸Œæœ›æˆ‘æ€éº¼åšï¼Ÿ",
      "å›ºå®šç›¸è™•ç¯€å¥æœƒè®“ä½ æ›´å®‰å¿ƒã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒæƒ³ï¼Œä½†ä½ ä¹Ÿå€¼å¾—è¢«å¥½å¥½æ„Ÿå—ã€‚"
  },

  ESTP: {
    name: "è¡é‹’å†’éšªç†Š",
    tags: ["è¡Œå‹•", "ç›´è¦ºåæ‡‰", "å¸¶æ°£æ°›"],
    traits: "å–œæ­¡åˆºæ¿€èˆ‡æŒ‘æˆ°ï¼Œæ“…é•·å³æ™‚æ‡‰è®Šèˆ‡æ¨é€²ã€‚",
    strengths: ["è¡Œå‹•åŠ›å¼·", "å±æ©Ÿè™•ç†", "æ„ŸæŸ“åŠ›"],
    blindspots: ["è€å¿ƒä¸è¶³", "ä¸æ„›ç´°ç¯€", "å®¹æ˜“è¡å‹•æ‰¿è«¾"],
    work: ["æ¥­å‹™/è«‡åˆ¤/BD", "æ´»å‹•/è¡ŒéŠ·", "ç¾å ´ç®¡ç†/ç‡Ÿé‹"],
    workTips: [
      "æŠŠã€è¡ã€é…ä¸Šã€æ”¶å°¾æ¸…å–®ã€ï¼Œä½ æœƒæ›´ç„¡æ•µã€‚",
      "é‡è¦æ±ºç­–å…ˆåœ 10 åˆ†é˜ï¼šå•é¢¨éšªèˆ‡æ›¿ä»£æ–¹æ¡ˆã€‚",
      "åˆ¥æŠŠç›´æ¥ç•¶æ•ˆç‡ï¼šåŠ ä¸€å¥å°Šé‡æœƒè®“ä½ æ›´å—æ­¡è¿ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆæœƒå¸¶å°æ–¹é«”é©—äººç”Ÿï¼Œä½†ä¹Ÿè¦çµ¦å®‰å…¨æ„Ÿèˆ‡æ‰¿è«¾ã€‚",
      "åµæ¶åˆ¥ç”¨ç©ç¬‘å¸¶éï¼šå…ˆæ‰¿èªæ„Ÿå—å†è§£æ±ºã€‚",
      "ä½ éœ€è¦è‡ªç”±ï¼Œä¹Ÿè¦è®“å°æ–¹çŸ¥é“ä½ æœƒå›ä¾†ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ æ˜¯ç«ç®­ï¼Œä½†ä¹Ÿè¦è¨˜å¾—åŠ æ²¹èˆ‡å°èˆªã€‚"
  },

  ESFP: {
    name: "æ­¡æ¨‚èˆå°ç†Š",
    tags: ["ç†±æƒ…", "ç¤¾äº¤", "äº«å—"],
    traits: "å¸¶ä¾†å¿«æ¨‚èˆ‡é€£çµï¼Œé‡è¦–é«”é©—èˆ‡ç•¶ä¸‹æ„Ÿå—ã€‚",
    strengths: ["äººéš›é­…åŠ›", "æ°£æ°›è£½é€ ", "çœŸèª ç›´æ¥"],
    blindspots: ["æ€•ç„¡èŠ", "å®¹æ˜“æƒ…ç·’åŒ–", "é•·æœŸè¦åŠƒå¼±"],
    work: ["æ´»å‹•/å…¬é—œ", "ä¸»æŒ/è¡¨æ¼”/å…§å®¹", "æœå‹™æ¥­/é¡§å®¢é«”é©—"],
    workTips: [
      "ç”¨ã€å°ç›®æ¨™ã€ç¶­æŒå‹•åŠ›ï¼šæ¯é€±ä¸€å€‹äº®é»ä»»å‹™ã€‚",
      "æŠŠæƒ…ç·’è®Šè³‡ç”¢ï¼šç”¨æ•…äº‹èªªæœï¼Œæ¯”ç¡¬è¬›æ›´å¼·ã€‚",
      "è²¡å‹™èˆ‡æ™‚é–“è¦æœ‰åŸºæœ¬è¦å‰‡ï¼Œæ‰ä¸æœƒè¢«å¿«æ¨‚æ‹–ç´¯ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆéœ€è¦å›æ‡‰èˆ‡é™ªä¼´ï¼šæŠŠéœ€æ±‚ç”¨å¯è¡Œæ–¹å¼æå‡ºã€‚",
      "è¡çªæ™‚åˆ¥ç”¨æƒ…ç·’æ¸¬è©¦ï¼Œå…ˆèªªï¼šæˆ‘ä¸èˆ’æœçš„é»æ˜¯â€¦",
      "ä¸€èµ·å‰µé€ å›æ†¶å¾ˆé‡è¦ï¼Œä¹Ÿè¦ä¸€èµ·é¢å°ç¾å¯¦ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¸¶ä¾†å…‰ï¼Œä½†ä½ ä¹Ÿè¦å­¸æœƒä¿è­·è‡ªå·±çš„å…‰ã€‚"
  },

  ENFP: {
    name: "ç«èŠ±æ¢éšªç†Š",
    tags: ["å‰µæ„", "ç†±æƒ…", "å¯èƒ½æ€§"],
    traits: "é»å­å¤šã€å–œæ­¡é€£çµäººèˆ‡æ©Ÿæœƒï¼Œç†±æ„›æ¢ç´¢ã€‚",
    strengths: ["å‰µæ–°èˆ‡æ„ŸæŸ“åŠ›", "å¿«é€Ÿé€£çµ", "é¼“èˆä»–äºº"],
    blindspots: ["åˆ†å¿ƒ", "è™é ­è›‡å°¾", "æƒ…ç·’èµ·ä¼"],
    work: ["å‰µæ„ä¼åŠƒ/è¡ŒéŠ·", "ç¤¾ç¾¤/å“ç‰Œ", "æ–°å‰µ/ç”¢å“æ¢ç´¢"],
    workTips: [
      "ä½ éœ€è¦ã€æ”¶æ–‚æ©Ÿåˆ¶ã€ï¼šä¸€æ¬¡åªæ¨é€² 1~2 å€‹ä¸»ç·šã€‚",
      "å»ºç«‹ã€å®Œæˆå„€å¼ã€ï¼šæ”¶å°¾æ¸…å–®ï¼‹æ…¶ç¥ 5 åˆ†é˜ã€‚",
      "æŠŠéˆæ„Ÿè½åœ°ï¼šç”¨çœ‹æ¿è¿½è¹¤ï¼Œåˆ¥åªå­˜åœ¨è…¦ä¸­ã€‚"
    ],
    loveTips: [
      "ä½ è¦è‡ªç”±ä¹Ÿè¦è¢«ç†è§£ï¼šç”¨ç´„å®šå–ä»£æŸç¸›ã€‚",
      "å°‘ä¸€é»çŒœæ¸¬ï¼Œå¤šä¸€é»ç¢ºèªï¼šä½ æ˜¯ä¸æ˜¯åœ¨æ„â€¦ï¼Ÿ",
      "æƒ…ç·’ä½æ½®æ™‚å…ˆèªªï¼šæˆ‘éœ€è¦é™ªä¼´/éœ€è¦ç¨è™•ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„å¯èƒ½æ€§å¾ˆå¤šï¼Œä½†ä½ ä¸éœ€è¦åŒæ™‚æˆç‚ºå…¨éƒ¨ã€‚"
  },

  ENTP: {
    name: "è¾¯è­‰ç™¼æ˜ç†Š",
    tags: ["æ©Ÿæ™º", "çªç ´", "é»å­"],
    traits: "å–œæ­¡æŒ‘æˆ°è§€é»ï¼Œæ“…é•·å‰µæ–°ã€è¾¯è­‰èˆ‡è«‡åˆ¤ã€‚",
    strengths: ["å‰µæ–°è§£æ³•", "èªªæœåŠ›", "å­¸ç¿’å¿«"],
    blindspots: ["å˜´å¿«å‚·äºº", "ä¸æ„›ä¾‹è¡Œ", "å®¹æ˜“å¿½ç•¥æƒ…ç·’"],
    work: ["å‰µæ–°/ç­–ç•¥/é¡§å•", "ç”¢å“/å•†å‹™è«‡åˆ¤", "å‰µæ¥­/æ–°ä¼åŠƒ"],
    workTips: [
      "æºé€šå…ˆé¡§æ„Ÿå—å†é¡§é‚è¼¯ï¼šå…ˆè‚¯å®šå†ææŒ‘æˆ°ã€‚",
      "çµ¦è‡ªå·±ä¸€å€‹ã€æ”¶å°¾æ­æª”ã€æˆ–æµç¨‹ï¼Œé¿å…å¡åœ¨é»å­æµ·ã€‚",
      "åˆ¥æŠŠåå°ç•¶æ¨‚è¶£ï¼šç”¨ã€æˆ‘å€‘ä¸€èµ·è®Šæ›´å¥½ã€çš„èªæ°£ã€‚"
    ],
    loveTips: [
      "ä½ éœ€è¦ç«èŠ±ï¼Œä¹Ÿè¦å­¸æœƒç©©å®šï¼šå›ºå®šæ‰¿è«¾æœƒåŠ åˆ†ã€‚",
      "è¾¯è«–ä¸æ˜¯æ„›ï¼šå°æ–¹è¦çš„æ˜¯è¢«ç†è§£ï¼Œä¸æ˜¯è¢«èªªæœã€‚",
      "ç·´ç¿’é“æ­‰ä¸åŠ ä½†æ›¸ï¼šæˆ‘å‰›å‰›è®“ä½ é›£å—äº†ï¼Œå°ä¸èµ·ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ çš„è…¦å¾ˆé‹’åˆ©ï¼Œè¨˜å¾—ç”¨ä¾†åˆ‡é–‹å•é¡Œï¼Œä¸è¦åˆ‡åˆ°äººã€‚"
  },

  ESTJ: {
    name: "ç§©åºæŒ‡æ®ç†Š",
    tags: ["é ˜å°", "æ•ˆç‡", "è¦å‰‡"],
    traits: "é‡è¦–æ•ˆç‡èˆ‡æˆæœï¼Œæ“…é•·çµ„ç¹”ã€æ±ºç­–èˆ‡æ¨å‹•ã€‚",
    strengths: ["åŸ·è¡ŒåŠ›", "ç®¡ç†èˆ‡å”èª¿", "è²¬ä»»æ„Ÿ"],
    blindspots: ["å®¹æ˜“å¼·ç¡¬", "ä¸è€æ…¢", "å¿½ç•¥æƒ…ç·’æˆæœ¬"],
    work: ["ç®¡ç†è·/ç‡Ÿé‹", "å°ˆæ¡ˆ/æµç¨‹", "å•†å‹™/çµ„ç¹”ç®¡ç†"],
    workTips: [
      "ç”¨ã€ç›®æ¨™ä¸€è‡´ã€å–ä»£ã€ä½ è¦ç…§åšã€ï¼Œæœƒæ›´å¾—äººå¿ƒã€‚",
      "å­¸æœƒæŠŠæ„Ÿå—ç´å…¥ KPIï¼šå£«æ°£ä¹Ÿæ˜¯æˆæœ¬ã€‚",
      "å…ˆå•ï¼šä½ éœ€è¦æˆ‘æ€éº¼å¹«ä½ ï¼Ÿå†ä¸‹æŒ‡ä»¤ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆå¯é ï¼Œä½†åˆ¥æŠŠæ„›è®Šæˆç®¡ç†ã€‚",
      "è¡çªæ™‚å…ˆè½å®Œï¼Œå†æå‡ºè¦å‰‡èˆ‡è§£æ³•ã€‚",
      "å¤šåšä¸€é»æº«æŸ”çš„è‚¯å®šï¼Œå°‘ä¸€é»ç³¾æ­£ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ èƒ½æ‰›äº‹ï¼Œä½†ä¸å¿…æ‰›æ‰€æœ‰äººçš„äººç”Ÿã€‚"
  },

  ESFJ: {
    name: "é—œä¿‚å®ˆè­·ç†Š",
    tags: ["ç…§é¡§", "å‡èš", "äº’åŠ©"],
    traits: "æ“…é•·ç…§é¡§åœ˜é«”æ°£æ°›ï¼Œé‡è¦–å’Œè«§èˆ‡æ­¸å±¬æ„Ÿã€‚",
    strengths: ["äººéš›ç¶“ç‡Ÿ", "åŒç†ç…§é¡§", "åœ˜éšŠå‡èš"],
    blindspots: ["æ€•è¢«æ‹’çµ•", "æ˜“éåº¦ä»˜å‡º", "åœ¨æ„ä»–äººçœ¼å…‰"],
    work: ["äººè³‡/è¡Œæ”¿", "ç¤¾ç¾¤/å®¢æˆ¶é—œä¿‚", "æ•™è‚²/æœå‹™ç®¡ç†"],
    workTips: [
      "ä½ çš„å„ªå‹¢æ˜¯ã€è®“å¤§å®¶æ›´å¥½ã€ï¼Œä½†è¦è¨˜å¾—ä¿ç•™è‡ªå·±ã€‚",
      "å­¸æœƒæ‹’çµ•ï¼šå…ˆçµ¦æ›¿ä»£æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯ç¡¬åã€‚",
      "ç•¶ä½ ç„¦æ…®æ™‚ï¼Œå…ˆå›åˆ°äº‹å¯¦ï¼šç¾åœ¨æˆ‘èƒ½åšçš„ä¸€æ­¥æ˜¯ï¼Ÿ"
    ],
    loveTips: [
      "ä½ å¾ˆæœƒç…§é¡§äººï¼Œä½†ä¹Ÿè¦èªªå‡ºï¼šæˆ‘æƒ³è¢«æ€éº¼æ„›ã€‚",
      "åˆ¥ç”¨ä»˜å‡ºæ›å®‰å…¨æ„Ÿï¼šç”¨æºé€šæ›ã€‚",
      "ç•¶å°æ–¹å†·æ·¡æ™‚ï¼Œå…ˆç¢ºèªå°æ–¹ç‹€æ…‹ï¼Œä¸è¦å…ˆè‡ªè²¬ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒæŠŠäººç…§äº®ï¼Œä½†ä½ è‡ªå·±ä¹Ÿè¦æœ‰å……é›»ç«™ã€‚"
  },

  ENFJ: {
    name: "å¼•å°é ˜èˆªç†Š",
    tags: ["é¼“èˆ", "å¸¶äºº", "å…±æ„Ÿ"],
    traits: "æ“…é•·ç†è§£äººèˆ‡å¸¶å‹•æ”¹è®Šï¼Œé‡è¦–æˆé•·èˆ‡æ„ç¾©ã€‚",
    strengths: ["é ˜å°èˆ‡æ•™ç·´", "é«˜åŒç†", "æ¿€å‹µä»–äºº"],
    blindspots: ["å®¹æ˜“éåº¦æ“å¿ƒ", "é›£ä»¥æ”¾æ‰‹", "è‡ªæˆ‘éœ€æ±‚è¢«å¿½ç•¥"],
    work: ["ç®¡ç†/æ•™ç·´/åŸ¹è¨“", "å“ç‰Œ/å…¬é—œ", "ç¤¾ç¾¤/çµ„ç¹”ç™¼å±•"],
    workTips: [
      "åˆ¥æŠŠæ¯å€‹äººçš„ç‹€æ…‹éƒ½æ‰›åœ¨èº«ä¸Šï¼šä½ çš„è²¬ä»»æ˜¯å¼•å°ï¼Œä¸æ˜¯æ‹¯æ•‘ã€‚",
      "å…ˆç¢ºèªå°æ–¹æ˜¯å¦æƒ³è¢«å¹«ï¼šä½ æƒ³è¦å»ºè­°é‚„æ˜¯é™ªä¼´ï¼Ÿ",
      "ç‚ºè‡ªå·±å®‰æ’ç„¡ç¤¾äº¤æ™‚é–“ï¼Œä½ æœƒæ›´ç©©ã€‚"
    ],
    loveTips: [
      "ä½ å¾ˆæœƒç…§é¡§å°æ–¹ï¼Œä½†ä¹Ÿè¦è®“å°æ–¹ç‚ºä½ ä»˜å‡ºã€‚",
      "é¿å…ã€æˆ‘éƒ½ç‚ºä½ å¥½ã€ï¼Œæ”¹æˆã€ä½ éœ€è¦æˆ‘æ€éº¼é™ªä½ ã€ã€‚",
      "è¡çªæ™‚å…ˆå›åˆ°å…±åŒç›®æ¨™ï¼šæˆ‘å€‘æƒ³è¦æ›´é è¿‘ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ èƒ½å¸¶å¾ˆå¤šäººèµ°é ï¼Œä½†ä¹Ÿè¦è¨˜å¾—ç‰½èµ·è‡ªå·±çš„æ‰‹ã€‚"
  },

  ENTJ: {
    name: "ç‹åœ‹çµ±å¸¥ç†Š",
    tags: ["æ±ºç­–", "ç›®æ¨™", "æ¨é€²"],
    traits: "é‡è¦–æˆæœèˆ‡æ•ˆç‡ï¼Œæ“…é•·åšæ±ºç­–ã€æ•´åˆè³‡æºã€æ¨å‹•å‹åˆ©ã€‚",
    strengths: ["é ˜å°æ¨é€²", "ç­–ç•¥è¦åŠƒ", "æŠ—å£“å¼·"],
    blindspots: ["å®¹æ˜“å£“è¿«æ„Ÿ", "å¿½ç•¥æƒ…ç·’", "æŠŠé—œä¿‚ç•¶å°ˆæ¡ˆ"],
    work: ["é«˜éšç®¡ç†/ç‡Ÿé‹", "ç­–ç•¥/å•†æ¥­æ‹“å±•", "å‰µæ¥­/ç”¢å“è² è²¬"],
    workTips: [
      "å¤šåš 1 æ¬¡å‚¾è½ï¼Œä½ çš„åœ˜éšŠæœƒå¤š 10 å€æˆ°åŠ›ã€‚",
      "æŠŠã€äººã€ç•¶æˆå…±åŒé«”ï¼Œä¸æ˜¯è³‡æºï¼šæƒ…ç·’æ˜¯ç‡ƒæ–™ã€‚",
      "é©åº¦å±•ç¾è„†å¼±æœƒæ›´æœ‰å‡èšåŠ›ã€‚"
    ],
    loveTips: [
      "ä½ æƒ³è¦ä¸€èµ·è®Šå¼·ï¼Œä½†å°æ–¹å¯èƒ½åªæƒ³è¢«æŠ±ä¸€ä¸‹ã€‚",
      "ç”¨æº«åº¦è£œä¸Šæ•ˆç‡ï¼šå…ˆå®‰æ’«å†è§£æ±ºã€‚",
      "ç·´ç¿’æŠŠæœŸå¾…èªªæ¸…æ¥šï¼Œä¸è¦é»˜é»˜æ‰£åˆ†ã€‚"
    ],
    bear: "ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæœƒè´ï¼Œä½†ä½ ä¹Ÿå€¼å¾—è¢«æº«æŸ”åœ°æ„›ã€‚"
  }
};

// è£œé½Šæ²’å¯«åˆ°çš„ 4 å‹ï¼ˆè®“ 16 å‹å®Œæ•´ï¼‰
Object.assign(MBTI, {
  INTJ: MBTI.INTJ,
  ENTJ: MBTI.ENTJ
});

// è‹¥ä¸Šé¢ä½ çœ‹åˆ°é‡è¤‡ï¼ˆå®‰å…¨èµ·è¦‹ï¼‰ï¼Œé€™è£¡è£œå››å€‹ä½ å¯èƒ½æ³¨æ„åˆ°ç¼ºçš„ï¼š
if (!MBTI.ENFP) MBTI.ENFP = { name:"ç«èŠ±æ¢éšªç†Š", tags:["å‰µæ„","ç†±æƒ…","å¯èƒ½æ€§"], traits:"", strengths:[], blindspots:[], work:[], workTips:[], loveTips:[], bear:"ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæ£’ã€‚" };
if (!MBTI.ENTP) MBTI.ENTP = { name:"è¾¯è­‰ç™¼æ˜ç†Š", tags:["æ©Ÿæ™º","çªç ´","é»å­"], traits:"", strengths:[], blindspots:[], work:[], workTips:[], loveTips:[], bear:"ğŸ» ç†Šç†Šæé†’ï¼šä½ å¾ˆæ£’ã€‚" };

// ------- UI ç¶å®š -------
const typeInput = document.getElementById("typeInput");
const goTypeBtn = document.getElementById("goTypeBtn");
const typeSelect = document.getElementById("typeSelect");
const randomBtn = document.getElementById("randomBtn");
const result = document.getElementById("result");
const testUrl = document.getElementById("testUrl");
const openTestBtn = document.getElementById("openTestBtn");

const pairA = document.getElementById("pairA");
const pairB = document.getElementById("pairB");
const pairBtn = document.getElementById("pairBtn");
const pairResult = document.getElementById("pairResult");

const bearBtn = document.getElementById("bearBtn");
const bubble = document.getElementById("bubble");

const dockInstall = document.getElementById("dockInstall");

let pairMode = "work"; // work | love
let deferredPrompt = null;

// ------- åˆå§‹åŒ–ä¸‹æ‹‰ -------
const TYPES = Object.keys(MBTI).sort();
function fillSelect(sel){
  sel.innerHTML = TYPES.map(t => `<option value="${t}">${t}ï½œ${MBTI[t].name}</option>`).join("");
}
fillSelect(typeSelect);
fillSelect(pairA);
fillSelect(pairB);

testUrl.value = DEFAULT_TEST_URL;

// ------- åŠŸèƒ½ï¼šæ ¼å¼åŒ–äººæ ¼å¡ -------
function normalizeType(s){
  return (s || "").trim().toUpperCase().replace(/[^A-Z]/g,"").slice(0,4);
}

function renderType(t){
  if(!MBTI[t]){
    result.textContent = `æ‰¾ä¸åˆ°ã€Œ${t}ã€\n\nè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦ç‚º 4 ç¢¼ï¼ˆä¾‹å¦‚ INFP / ESTJï¼‰`;
    return;
  }
  const d = MBTI[t];

  const pills = [
    `<span class="pill"><b>${t}</b>ï½œ${d.name}</span>`,
    ...(d.tags || []).map(x => `<span class="pill">âœ¨ ${x}</span>`)
  ].join("");

  const block = `
<div class="kv">${pills}</div>
<b>äººæ ¼ç‰¹è³ªï¼š</b> ${d.traits}

<b>å„ªå‹¢ï¼š</b>
- ${d.strengths.join("\n- ")}

<b>å¯èƒ½ç›²é»ï¼š</b>
- ${d.blindspots.join("\n- ")}

<b>é©åˆå·¥ä½œ/é ˜åŸŸï¼š</b>
- ${d.work.join("\n- ")}

<b>è·å ´æé†’ï¼ˆæ›´é †ã€æ›´ä¸è€—èƒ½ï¼‰ï¼š</b>
- ${d.workTips.join("\n- ")}

<b>è¦ªå¯†é—œä¿‚å»ºè­°ï¼ˆæ›´é è¿‘ã€æ›´å®‰å¿ƒï¼‰ï¼š</b>
- ${d.loveTips.join("\n- ")}

<b>ç†Šç†Šæé†’ï¼š</b>
${d.bear}
  `.trim();

result.innerHTML = `<div class="result">${block}</div>`;}

// ä¿ç•™æ›è¡Œçš„å®‰å…¨è¼¸å‡º
function escapeToHtml(text){
  const esc = text
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
  return esc.replaceAll("\n","<br>");
}

// ------- æŸ¥è©¢äº‹ä»¶ -------
goTypeBtn.addEventListener("click", ()=>{
  const t = normalizeType(typeInput.value) || typeSelect.value;
  typeSelect.value = MBTI[t] ? t : typeSelect.value;
  renderType(MBTI[t] ? t : typeSelect.value);
});

typeSelect.addEventListener("change", ()=>{
  typeInput.value = typeSelect.value;
  renderType(typeSelect.value);
});

typeInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") goTypeBtn.click();
});

randomBtn.addEventListener("click", ()=>{
  const t = TYPES[Math.floor(Math.random()*TYPES.length)];
  typeSelect.value = t;
  typeInput.value = t;
  renderType(t);
});

openTestBtn.addEventListener("click", ()=>{
  const url = (testUrl.value || DEFAULT_TEST_URL).trim();
  if(!/^https?:\/\//i.test(url)){
    alert("è«‹è¼¸å…¥ä»¥ http(s):// é–‹é ­çš„ç¶²å€");
    return;
  }
  window.open(url, "_blank", "noopener");
});

// ------- ç†Šç†Šæ°£æ³¡ -------
function randomBearLine(){
  return BEAR_QUOTES[Math.floor(Math.random()*BEAR_QUOTES.length)];
}

bearBtn.addEventListener("click", ()=>{
  bubble.textContent = randomBearLine();
});

bubble.addEventListener("copy", ()=>{});
bubble.addEventListener("contextmenu", ()=>{});

// é•·æŒ‰è¤‡è£½ï¼ˆæ‰‹æ©Ÿå¥½ç”¨ï¼‰
bubble.addEventListener("pointerdown", (e)=>{
  const start = Date.now();
  const timer = setTimeout(async ()=>{
    try{
      await navigator.clipboard.writeText(bubble.textContent);
      bubble.textContent = "âœ… å·²è¤‡è£½ï¼è¨˜å¾—å°è‡ªå·±æº«æŸ”ä¸€é»ï½";
      setTimeout(()=> bubble.textContent = randomBearLine(), 900);
    }catch(err){
      // ç„¡å‰ªè²¼ç°¿æ¬Šé™å°±ä¸åšäº‹
    }
  }, 520);

  const up = ()=>{
    clearTimeout(timer);
    window.removeEventListener("pointerup", up);
    window.removeEventListener("pointercancel", up);
  };
  window.addEventListener("pointerup", up);
  window.addEventListener("pointercancel", up);
});

// ------- é…å°åˆ†æï¼ˆè¦å‰‡å¼ï¼šå››å‘å·®ç•°ï¼‹çµ¦èª¿æ•´æ–¹å‘ï¼‰ -------
function diffLetters(a,b){
  const pairs = [
    ["E","I","èƒ½é‡ä¾†æºï¼ˆå¤–å‘/å…§å‘ï¼‰"],
    ["S","N","è³‡è¨Šåå¥½ï¼ˆç´°ç¯€/å¯èƒ½æ€§ï¼‰"],
    ["T","F","æ±ºç­–åå¥½ï¼ˆé‚è¼¯/æ„Ÿå—ï¼‰"],
    ["J","P","ç”Ÿæ´»ç¯€å¥ï¼ˆè¨ˆç•«/å½ˆæ€§ï¼‰"],
  ];
  const diffs = [];
  for(const [x,y,label] of pairs){
    const ia = a.includes(x) ? x : y;
    const ib = b.includes(x) ? x : y;
    if(ia !== ib) diffs.push({label, a: ia, b: ib});
  }
  return diffs;
}

function pairingAdvice(a,b,mode){
  const diffs = diffLetters(a,b);
  const sameCount = 4 - diffs.length;

  const scoreWord =
    sameCount === 4 ? "é»˜å¥‘å¾ˆé«˜" :
    sameCount === 3 ? "é»˜å¥‘åé«˜" :
    sameCount === 2 ? "äº’è£œå‹" :
    sameCount === 1 ? "å·®ç•°å¾ˆå¤§ä½†å¯äº’è£œ" :
    "å®Œå…¨äº’è£œï¼ˆéœ€è¦åˆ»æ„ç·´ç¿’ï¼‰";

  let lines = [];
  lines.push(`Aï¼š${a}ï½œ${MBTI[a].name}`);
  lines.push(`Bï¼š${b}ï½œ${MBTI[b].name}`);
  lines.push(`\næ•´é«”æ„Ÿè¦ºï¼š${scoreWord}`);
  lines.push(`å·®ç•°é»ï¼š${diffs.length ? "" : "å¹¾ä¹åŒé »"}`);

  if(diffs.length){
    for(const d of diffs){
      lines.push(`- ${d.label}ï¼šA(${d.a}) vs B(${d.b})`);
    }
  }

  // æƒ…å¢ƒå»ºè­°
  if(mode === "work"){
    lines.push(`\nã€è·å ´ç›¸è™•æ€éº¼æ›´é †ã€‘`);
    if(diffs.some(x=>x.label.includes("è³‡è¨Šåå¥½"))){
      lines.push(`- ä¸€ä½æ„›ç´°ç¯€ã€ä¸€ä½æ„›æ–¹å‘ï¼šå…ˆå®šç¾©ã€Œæˆæœé•·ä»€éº¼æ¨£ã€ï¼Œå†åˆ†å·¥ï¼ˆèª°è² è²¬ç´°ç¯€/èª°è² è²¬æ¡†æ¶ï¼‰ã€‚`);
    }
    if(diffs.some(x=>x.label.includes("æ±ºç­–åå¥½"))){
      lines.push(`- ä¸€ä½é‡é‚è¼¯ã€ä¸€ä½é‡æ„Ÿå—ï¼šæœƒè­°å…ˆè¬›ã€Œäº‹å¯¦èˆ‡é¸é …ã€ï¼Œæœ€å¾Œå†è¬›ã€Œå½±éŸ¿åˆ°èª°ã€æ€éº¼ç…§é¡§äººã€ã€‚`);
    }
    if(diffs.some(x=>x.label.includes("ç”Ÿæ´»ç¯€å¥"))){
      lines.push(`- ä¸€ä½æ„›è¨ˆç•«ã€ä¸€ä½æ„›å½ˆæ€§ï¼šç”¨ã€Œæœ€å°å¿…è¦è¦å‰‡ã€åˆä½œï¼ˆæˆªæ­¢æ—¥/è²¬ä»»äººï¼‰ï¼Œå…¶ä»–çµ¦è‡ªç”±ã€‚`);
    }
    if(diffs.some(x=>x.label.includes("èƒ½é‡ä¾†æº"))){
      lines.push(`- ä¸€ä½éœ€è¦ç¤¾äº¤è¨è«–ã€ä¸€ä½éœ€è¦ç¨è™•æ€è€ƒï¼šå…ˆçµ¦æ™‚é–“æƒ³ï¼Œå†ç´„å›ºå®šè¨è«–é»ï¼ˆé¿å…å³å¸­é€¼è¿«ï¼‰ã€‚`);
    }
    lines.push(`- ç†Šç†Šå°æ‹›ï¼šç”¨ä¸€å¥è©±ç¢ºèªå½¼æ­¤åå¥½ï¼šã€Œä½ æƒ³å…ˆè«‡å¤§æ–¹å‘ï¼Œé‚„æ˜¯å…ˆæŠŠç´°ç¯€å°é½Šï¼Ÿã€`);
  } else {
    lines.push(`\nã€è¦ªå¯†é—œä¿‚æ€éº¼æ›´é è¿‘ã€‘`);
    if(diffs.some(x=>x.label.includes("èƒ½é‡ä¾†æº"))){
      lines.push(`- å¤–å‘éœ€è¦äº’å‹•ã€å…§å‘éœ€è¦å……é›»ï¼šå»ºç«‹ã€Œå¯é æœŸçš„ç›¸è™•ç¯€å¥ã€ï¼ˆä¾‹å¦‚æ¯é€±ç´„æœƒï¼‹æ¯å¤©å„è‡ªæ™‚é–“ï¼‰ã€‚`);
    }
    if(diffs.some(x=>x.label.includes("æ±ºç­–åå¥½"))){
      lines.push(`- é‚è¼¯æ´¾åˆ¥æ€¥è‘—è§£æ±ºï¼Œæ„Ÿå—æ´¾åˆ¥å…ˆè¢«ç†è§£ï¼šè¡çªé †åºæ”¹æˆã€Œå…ˆå®‰æ’« â†’ å†è¨è«– â†’ å†è¡Œå‹•ã€ã€‚`);
    }
    if(diffs.some(x=>x.label.includes("ç”Ÿæ´»ç¯€å¥"))){
      lines.push(`- è¨ˆç•«æ´¾éœ€è¦æ‰¿è«¾ï¼Œå½ˆæ€§æ´¾éœ€è¦è‡ªç”±ï¼šç”¨ã€Œç´„å®šã€å–ä»£ã€Œæ§åˆ¶ã€ï¼Œä¾‹å¦‚ï¼šæœ€æ™šå¹¾é»å›è¨Šã€é‡è¦æ—¥å­å¿…åšã€‚`);
    }
    if(diffs.some(x=>x.label.includes("è³‡è¨Šåå¥½"))){
      lines.push(`- ç´°ç¯€æ´¾åœ¨ä¹è¸å¯¦ï¼Œç›´è¦ºæ´¾åœ¨ä¹é¡˜æ™¯ï¼šä¸€å€‹èªªã€Œæˆ‘éœ€è¦ä»€éº¼ã€ï¼Œä¸€å€‹èªªã€Œæˆ‘æƒ³å»å“ªè£¡ã€ï¼Œå…©è€…éƒ½è¬›æ‰å®‰å…¨ã€‚`);
    }
    lines.push(`- ç†Šç†Šå°æ‹›ï¼šæ¯å¤©ä¸€å¥ç¢ºèªï¼šã€Œæˆ‘ä»Šå¤©æœ€éœ€è¦çš„æ˜¯é™ªä¼´/ç©ºé–“/è¢«è‚¯å®š/è¢«ç†è§£ï¼Ÿã€`);
  }

  lines.push(`\nğŸ» ç†Šç†Šæé†’ï¼šç›¸å®¹ä¸æ˜¯å¤©ç”Ÿï¼Œæ˜¯ä¸€èµ·ç·´å‡ºä¾†çš„é»˜å¥‘ã€‚`);

  return lines.join("\n");
}

pairBtn.addEventListener("click", ()=>{
  const a = pairA.value;
  const b = pairB.value;
  pairResult.textContent = pairingAdvice(a,b,pairMode);
});

// åˆ‡æ›è·å ´/è¦ªå¯†
document.querySelectorAll(".seg-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".seg-btn").forEach(x=>x.classList.remove("active"));
    btn.classList.add("active");
    pairMode = btn.dataset.mode;
  });
});

// ------- PWA å®‰è£ï¼šæ¥ä½ beforeinstallprompt -------
window.addEventListener("beforeinstallprompt", (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  dockInstall.textContent = "â• æ–°å¢åˆ°ä¸»ç•«é¢";
});

dockInstall.addEventListener("click", async ()=>{
  if(!deferredPrompt){
    alert("è‹¥ä½ æ˜¯ iPhoneï¼šè«‹ç”¨ Safari é–‹å•Ÿ â†’ åˆ†äº« â†’ åŠ åˆ°ä¸»ç•«é¢ã€‚\nè‹¥æ˜¯ Androidï¼šé€šå¸¸æœƒå‡ºç¾å®‰è£æç¤ºæˆ–å³ä¸Šè§’é¸å–®å¯å®‰è£ã€‚");
    return;
  }
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  deferredPrompt = null;
  dockInstall.textContent = choice?.outcome === "accepted" ? "âœ… å·²åŠ å…¥" : "â• æ–°å¢åˆ°ä¸»ç•«é¢";
});

// ------- Service Worker -------
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  });
}

// åˆå§‹é è¦½
renderType("INFP");
typeSelect.value = "INFP";
typeInput.value = "INFP";
